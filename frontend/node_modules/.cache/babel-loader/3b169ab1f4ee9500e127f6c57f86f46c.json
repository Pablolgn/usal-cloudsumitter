{"ast":null,"code":"import _extends from '@babel/runtime/helpers/esm/extends';\nimport _objectWithoutPropertiesLoose from '@babel/runtime/helpers/esm/objectWithoutPropertiesLoose';\nimport * as THREE from 'three';\nimport { Raycaster, Vector2, OrthographicCamera, PerspectiveCamera, WebGLRenderer, Scene, Vector3, Math as Math$1 } from 'three';\nimport { createContext, memo, useRef, useState, useEffect, useCallback, createElement, useContext, useMemo } from 'react';\nimport ResizeObserver from 'resize-observer-polyfill';\nimport Reconciler from 'react-reconciler';\nimport { unstable_now, unstable_scheduleCallback, unstable_cancelCallback, unstable_runWithPriority, unstable_IdlePriority } from 'scheduler';\n\nfunction _toPropertyKey(arg) {\n  var key = _toPrimitive(arg, \"string\");\n\n  return typeof key === \"symbol\" ? key : String(key);\n}\n\nfunction _toPrimitive(input, hint) {\n  if (typeof input !== \"object\" || input === null) return input;\n  var prim = input[Symbol.toPrimitive];\n\n  if (prim !== undefined) {\n    var res = prim.call(input, hint || \"default\");\n    if (typeof res !== \"object\") return res;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n\n  return (hint === \"string\" ? String : Number)(input);\n}\n\nconst roots = new Map();\nconst emptyObject = {};\nconst is = {\n  obj: a => a === Object(a),\n  str: a => typeof a === 'string',\n  num: a => typeof a === 'number',\n  und: a => a === void 0,\n  arr: a => Array.isArray(a),\n\n  equ(a, b) {\n    // Wrong type, doesn't match\n    if (typeof a !== typeof b) return false; // Atomic, just compare a against b\n\n    if (is.str(a) || is.num(a) || is.obj(a)) return a === b; // Array, shallow compare first to see if it's a match\n\n    if (is.arr(a) && a == b) return true; // Last resort, go through keys\n\n    let i;\n\n    for (i in a) if (!(i in b)) return false;\n\n    for (i in b) if (a[i] !== b[i]) return false;\n\n    return is.und(i) ? a === b : true;\n  }\n\n};\nlet globalEffects = [];\n\nfunction addEffect(callback) {\n  globalEffects.push(callback);\n}\n\nfunction renderGl(state, time, repeat, runGlobalEffects) {\n  if (repeat === void 0) {\n    repeat = 0;\n  }\n\n  if (runGlobalEffects === void 0) {\n    runGlobalEffects = false;\n  } // Run global effects\n\n\n  if (runGlobalEffects) globalEffects.forEach(effect => effect(time) && repeat++); // Decrease frame count\n\n  state.current.frames = Math.max(0, state.current.frames - 1);\n  repeat += !state.current.invalidateFrameloop ? 1 : state.current.frames; // Run local effects\n\n  state.current.subscribers.forEach(fn => fn(state.current, time)); // Render content\n\n  if (!state.current.manual) state.current.gl.render(state.current.scene, state.current.camera);\n  return repeat;\n}\n\nlet running = false;\n\nfunction renderLoop(t) {\n  running = true;\n  let repeat = 0; // Run global effects\n\n  globalEffects.forEach(effect => effect(t) && repeat++);\n  roots.forEach(root => {\n    const state = root.containerInfo.__state; // If the frameloop is invalidated, do not run another frame\n\n    if (state.current.active && state.current.ready && (!state.current.invalidateFrameloop || state.current.frames > 0)) repeat = renderGl(state, t, repeat);\n  });\n  if (repeat !== 0) return requestAnimationFrame(renderLoop); // Flag end of operation\n\n  running = false;\n}\n\nfunction invalidate(state, frames) {\n  if (frames === void 0) {\n    frames = 1;\n  }\n\n  if (state && state.current) {\n    if (state.current.vr) return;\n    state.current.frames = frames;\n  } else if (state === true) roots.forEach(root => root.containerInfo.__state.current.frames = frames);\n\n  if (!running) {\n    running = true;\n    requestAnimationFrame(renderLoop);\n  }\n}\n\nlet catalogue = {};\n\nconst apply = objects => catalogue = _extends({}, catalogue, objects);\n\nfunction applyProps(instance, newProps, oldProps, container) {\n  if (oldProps === void 0) {\n    oldProps = {};\n  } // Filter equals, events and reserved props\n\n\n  const sameProps = Object.keys(newProps).filter(key => is.equ(newProps[key], oldProps[key]));\n  const handlers = Object.keys(newProps).filter(key => typeof newProps[key] === 'function' && key.startsWith('on'));\n  const filteredProps = [...sameProps, 'children', 'key', 'ref'].reduce((acc, prop) => {\n    let _ = acc[prop],\n        rest = _objectWithoutPropertiesLoose(acc, [prop].map(_toPropertyKey));\n\n    return rest;\n  }, newProps);\n\n  if (Object.keys(filteredProps).length > 0) {\n    Object.entries(filteredProps).forEach(_ref => {\n      let key = _ref[0],\n          value = _ref[1];\n\n      if (!handlers.includes(key)) {\n        let root = instance;\n        let target = root[key];\n\n        if (key.includes('-')) {\n          const entries = key.split('-');\n          target = entries.reduce((acc, key) => acc[key], instance); // If the target is atomic, it forces us to switch the root\n\n          if (!(target && target.set)) {\n            const _entries$reverse = entries.reverse(),\n                  name = _entries$reverse[0],\n                  reverseEntries = _entries$reverse.slice(1);\n\n            root = reverseEntries.reverse().reduce((acc, key) => acc[key], instance);\n            key = name;\n          }\n        } // Special treatment for objects with support for set/copy\n\n\n        if (target && target.set && target.copy) {\n          if (target.constructor.name === value.constructor.name) target.copy(value);else if (Array.isArray(value)) target.set(...value);else target.set(value); // Else, just overwrite the value\n        } else root[key] = value;\n\n        invalidateInstance(instance);\n      }\n    }); // Prep interaction handlers\n\n    if (handlers.length) {\n      // Add interactive object to central container\n      if (container && instance.raycast && !(handlers.length === 1 && handlers[0] === 'onUpdate')) {\n        container.__interaction.push(instance);\n      }\n\n      instance.__handlers = handlers.reduce((acc, key) => _extends({}, acc, {\n        [key.charAt(2).toLowerCase() + key.substr(3)]: newProps[key]\n      }), {});\n    } // Call the update lifecycle when it is being updated\n\n\n    if (!container) updateInstance(instance);\n  }\n}\n\nfunction invalidateInstance(instance) {\n  if (instance.__container && instance.__container.__state) invalidate(instance.__container.__state);\n}\n\nfunction updateInstance(instance) {\n  if (instance.__handlers && instance.__handlers.update) instance.__handlers.update(instance);\n}\n\nfunction createInstance(type, _ref2, container) {\n  let _ref2$args = _ref2.args,\n      args = _ref2$args === void 0 ? [] : _ref2$args,\n      props = _objectWithoutPropertiesLoose(_ref2, [\"args\"]);\n\n  let name = \"\" + type[0].toUpperCase() + type.slice(1);\n  let instance;\n  if (type === 'primitive') instance = props.object;else {\n    const target = catalogue[name] || THREE[name];\n    instance = is.arr(args) ? new target(...args) : new target(args);\n  } // Apply initial props\n\n  instance.__objects = [];\n  instance.__container = container;\n  applyProps(instance, props, {}, container);\n  return instance;\n}\n\nfunction appendChild(parentInstance, child) {\n  if (child) {\n    if (child.isObject3D) parentInstance.add(child);else {\n      parentInstance.__objects.push(child);\n\n      child.parent = parentInstance; // The attach attribute implies that the object attaches itself on the parent\n\n      if (child.attach) parentInstance[child.attach] = child;else if (child.attachArray) {\n        if (!is.arr(parentInstance[child.attachArray])) parentInstance[child.attachArray] = [];\n        parentInstance[child.attachArray].push(child);\n      } else if (child.attachObject) {\n        if (!is.obj(parentInstance[child.attachObject[0]])) parentInstance[child.attachObject[0]] = {};\n        parentInstance[child.attachObject[0]][child.attachObject[1]] = child;\n      }\n    }\n    updateInstance(child);\n    invalidateInstance(child);\n  }\n}\n\nfunction insertBefore(parentInstance, child, beforeChild) {\n  if (child) {\n    if (child.isObject3D) {\n      child.parent = parentInstance;\n      child.dispatchEvent({\n        type: 'added'\n      }); // TODO: the order is out of whack if data objects are present, has to be recalculated\n\n      const index = parentInstance.children.indexOf(beforeChild);\n      parentInstance.children = [...parentInstance.children.slice(0, index), child, ...parentInstance.children.slice(index)];\n      updateInstance(child);\n    } else appendChild(parentInstance, child); // TODO: order!!!\n\n\n    invalidateInstance(child);\n  }\n}\n\nfunction removeChild(parentInstance, child) {\n  if (child) {\n    if (child.isObject3D) {\n      parentInstance.remove(child);\n    } else {\n      child.parent = undefined;\n      parentInstance.__objects = parentInstance.__objects.filter(x => x !== child); // Remove attachment\n\n      if (child.attach) parentInstance[child.attach] = undefined;else if (child.attachArray) parentInstance[child.attachArray] = parentInstance[child.attachArray].filter(x => x !== child);else if (child.attachObject) parentInstance[child.attachObject[0]][child.attachObject[1]] = undefined;\n    }\n\n    invalidateInstance(child);\n    unstable_runWithPriority(unstable_IdlePriority, () => {\n      // Remove interactivity\n      if (child.__container) child.__container.__interaction = child.__container.__interaction.filter(x => x !== child); // Remove nested child objects\n\n      if (child.__objects) child.__objects.forEach(obj => removeChild(child, obj));\n      if (child.children) child.children.forEach(obj => removeChild(child, obj)); // Dispose item\n\n      if (child.dispose) child.dispose(); // Remove references\n\n      delete child.__container;\n      delete child.__objects;\n    });\n  }\n}\n\nconst Renderer = Reconciler({\n  now: unstable_now,\n  createInstance,\n  removeChild,\n  appendChild,\n  insertBefore,\n  supportsMutation: true,\n  isPrimaryRenderer: false,\n  schedulePassiveEffects: unstable_scheduleCallback,\n  cancelPassiveEffects: unstable_cancelCallback,\n  appendInitialChild: appendChild,\n  appendChildToContainer: appendChild,\n  removeChildFromContainer: removeChild,\n  insertInContainerBefore: insertBefore,\n\n  commitUpdate(instance, updatePayload, type, oldProps, newProps, fiber) {\n    if (instance.isObject3D) {\n      applyProps(instance, newProps, oldProps);\n    } else {\n      // This is a data object, let's extract critical information about it\n      const parent = instance.parent;\n\n      const _newProps$args = newProps.args,\n            argsNew = _newProps$args === void 0 ? [] : _newProps$args,\n            restNew = _objectWithoutPropertiesLoose(newProps, [\"args\"]);\n\n      const _oldProps$args = oldProps.args,\n            argsOld = _oldProps$args === void 0 ? [] : _oldProps$args,\n            restOld = _objectWithoutPropertiesLoose(oldProps, [\"args\"]); // If it has new props or arguments, then it needs to be re-instanciated\n      // TODO, are colors falsely detected here?\n\n\n      if (argsNew.some((value, index) => value !== argsOld[index])) {\n        // Next we create a new instance and append it again\n        const newInstance = createInstance(type, newProps, instance.__container);\n        removeChild(parent, instance);\n        appendChild(parent, newInstance) // This evil hack switches the react-internal fiber node\n        // https://github.com/facebook/react/issues/14983\n        // https://github.com/facebook/react/pull/15021\n        ;\n        [fiber, fiber.alternate].forEach(fiber => {\n          if (fiber !== null) {\n            fiber.stateNode = newInstance;\n\n            if (fiber.ref) {\n              if (typeof fiber.ref === 'function') fiber.ref(newInstance);else fiber.ref.current = newInstance;\n            }\n          }\n        });\n      } else {\n        // Otherwise just overwrite props\n        applyProps(instance, restNew, restOld);\n      }\n    }\n  },\n\n  getPublicInstance(instance) {\n    return instance;\n  },\n\n  getRootHostContext(rootContainerInstance) {\n    return emptyObject;\n  },\n\n  getChildHostContext(parentHostContext, type) {\n    return emptyObject;\n  },\n\n  createTextInstance() {},\n\n  finalizeInitialChildren(instance, type, props, rootContainerInstance) {\n    return false;\n  },\n\n  prepareUpdate(instance, type, oldProps, newProps, rootContainerInstance, hostContext) {\n    return emptyObject;\n  },\n\n  shouldDeprioritizeSubtree(type, props) {\n    return false;\n  },\n\n  prepareForCommit() {},\n\n  resetAfterCommit() {},\n\n  shouldSetTextContent(props) {\n    return false;\n  }\n\n});\n\nfunction render(element, container, state) {\n  let root = roots.get(container);\n\n  if (!root) {\n    root = Renderer.createContainer(container);\n    container.__state = state;\n    roots.set(container, root);\n  }\n\n  Renderer.updateContainer(element, root, null, undefined);\n  return Renderer.getPublicRootInstance(root);\n}\n\nfunction unmountComponentAtNode(container) {\n  const root = roots.get(container);\n  if (root) Renderer.updateContainer(null, root, null, () => roots.delete(container));\n}\n\nconst defaultRef = {\n  ready: false,\n  subscribers: [],\n  manual: false,\n  vr: false,\n  active: true,\n  canvas: undefined,\n  gl: undefined,\n  camera: undefined,\n  raycaster: undefined,\n  mouse: undefined,\n  scene: undefined,\n  size: undefined,\n  canvasRect: undefined,\n  frames: 0,\n  aspect: 0,\n  viewport: undefined,\n  captured: undefined,\n  invalidateFrameloop: false,\n  subscribe: fn => () => {},\n  setManual: takeOverRenderloop => {},\n  setDefaultCamera: cam => {},\n  invalidate: () => {}\n};\nconst stateContext = createContext(defaultRef);\n\nfunction useMeasure() {\n  const ref = useRef();\n\n  const _useState = useState({\n    left: 0,\n    top: 0,\n    width: 0,\n    height: 0\n  }),\n        bounds = _useState[0],\n        set = _useState[1];\n\n  const _useState2 = useState(() => new ResizeObserver(_ref => {\n    let entry = _ref[0];\n    return set(entry.contentRect);\n  })),\n        ro = _useState2[0];\n\n  useEffect(() => {\n    if (ref.current) ro.observe(ref.current);\n    return () => ro.disconnect();\n  }, [ref.current]);\n  return [{\n    ref\n  }, bounds];\n}\n\nconst Canvas = memo(_ref2 => {\n  let children = _ref2.children,\n      gl = _ref2.gl,\n      camera = _ref2.camera,\n      orthographic = _ref2.orthographic,\n      raycaster = _ref2.raycaster,\n      style = _ref2.style,\n      pixelRatio = _ref2.pixelRatio,\n      _ref2$vr = _ref2.vr,\n      vr = _ref2$vr === void 0 ? false : _ref2$vr,\n      _ref2$invalidateFrame = _ref2.invalidateFrameloop,\n      invalidateFrameloop = _ref2$invalidateFrame === void 0 ? false : _ref2$invalidateFrame,\n      onCreated = _ref2.onCreated,\n      rest = _objectWithoutPropertiesLoose(_ref2, [\"children\", \"gl\", \"camera\", \"orthographic\", \"raycaster\", \"style\", \"pixelRatio\", \"vr\", \"invalidateFrameloop\", \"onCreated\"]); // Local, reactive state\n\n\n  const canvas = useRef();\n\n  const _useState3 = useState(false),\n        ready = _useState3[0],\n        setReady = _useState3[1];\n\n  const _useMeasure = useMeasure(),\n        bind = _useMeasure[0],\n        size = _useMeasure[1];\n\n  const _useState4 = useState(() => {\n    const ray = new Raycaster();\n    if (raycaster) applyProps(ray, raycaster, {});\n    return ray;\n  }),\n        defaultRaycaster = _useState4[0];\n\n  const _useState5 = useState(() => new Vector2()),\n        mouse = _useState5[0];\n\n  const _useState6 = useState(() => {\n    const cam = orthographic ? new OrthographicCamera(0, 0, 0, 0, 0.1, 1000) : new PerspectiveCamera(75, 0, 0.1, 1000);\n    cam.position.z = 5;\n    if (camera) applyProps(cam, camera, {});\n    return cam;\n  }),\n        defaultCam = _useState6[0],\n        _setDefaultCamera = _useState6[1]; // Public state\n\n\n  const state = useRef(_extends({}, defaultRef, {\n    subscribe: fn => {\n      state.current.subscribers.push(fn);\n      return () => state.current.subscribers = state.current.subscribers.filter(s => s !== fn);\n    },\n    setManual: takeOverRenderloop => {\n      state.current.manual = takeOverRenderloop;\n\n      if (takeOverRenderloop) {\n        // In manual mode items shouldn't really be part of the internal scene which has adverse effects\n        // on the camera being unable to update without explicit calls to updateMatrixWorl()\n        state.current.scene.children.forEach(child => state.current.scene.remove(child));\n      }\n    },\n    setDefaultCamera: cam => {\n      state.current.camera = cam;\n\n      _setDefaultCamera(cam);\n    },\n    invalidate: () => invalidate(state),\n    intersect: function intersect(event) {\n      if (event === void 0) {\n        event = {};\n      }\n\n      return handlePointerMove(event);\n    }\n  })); // This is used as a clone of the current state, to be distributed through context and useThree\n\n  const sharedState = useRef(state.current); // Writes locals into public state for distribution among subscribers, context, etc\n\n  useEffect(() => {\n    state.current.ready = ready;\n    state.current.size = size;\n    state.current.camera = defaultCam;\n    state.current.invalidateFrameloop = invalidateFrameloop;\n    state.current.vr = vr;\n    state.current.raycaster = defaultRaycaster;\n    state.current.mouse = mouse;\n  }, [invalidateFrameloop, vr, ready, size, defaultCam]); // Component mount effect, creates the webGL render context\n\n  useEffect(() => {\n    state.current.gl = new WebGLRenderer(_extends({\n      canvas: canvas.current,\n      antialias: true,\n      alpha: true\n    }, gl));\n    if (pixelRatio) state.current.gl.setPixelRatio(pixelRatio);\n    state.current.gl.setClearAlpha(0);\n    state.current.canvas = canvas.current;\n    state.current.scene = new Scene();\n    state.current.scene.__interaction = [];\n    state.current.scene.__objects = []; // Start render-loop, either via RAF or setAnimationLoop for VR\n\n    if (!state.current.vr) invalidate(state);else {\n      state.current.gl.vr.enabled = true;\n      state.current.gl.setAnimationLoop(t => renderGl(state, t, 0, true));\n    } // Clean-up\n\n    return () => {\n      state.current.gl.dispose();\n      state.current.active = false;\n      unmountComponentAtNode(state.current.scene);\n    };\n  }, []); // Adjusts default camera\n\n  useEffect(() => {\n    state.current.aspect = size.width / size.height || 0;\n\n    if (state.current.camera.isOrthographicCamera) {\n      state.current.viewport = {\n        width: size.width,\n        height: size.height,\n        factor: 1\n      };\n    } else {\n      const target = new Vector3(0, 0, 0);\n      const distance = state.current.camera.position.distanceTo(target);\n      const fov = Math$1.degToRad(state.current.camera.fov); // convert vertical fov to radians\n\n      const height = 2 * Math.tan(fov / 2) * distance; // visible height\n\n      const width = height * state.current.aspect;\n      state.current.viewport = {\n        width,\n        height,\n        factor: size.width / width\n      };\n    }\n\n    state.current.canvasRect = bind.ref.current.getBoundingClientRect();\n\n    if (ready) {\n      state.current.gl.setSize(size.width, size.height);\n\n      if (state.current.camera.isOrthographicCamera) {\n        state.current.camera.left = size.width / -2;\n        state.current.camera.right = size.width / 2;\n        state.current.camera.top = size.height / 2;\n        state.current.camera.bottom = size.height / -2;\n      } else {\n        state.current.camera.aspect = state.current.aspect;\n        state.current.camera.radius = (size.width + size.height) / 4;\n      }\n\n      state.current.camera.updateProjectionMatrix();\n      invalidate(state);\n    } // Only trigger the context provider when necessary\n\n\n    sharedState.current = _extends({}, state.current);\n  }, [ready, size, defaultCam]); // This component is a bridge into the three render context, when it gets rendererd\n  // we know we are ready to compile shaders, call subscribers, etc\n\n  const IsReady = useCallback(() => {\n    const activate = useCallback(() => void (setReady(true), invalidate(state)), []);\n    useEffect(() => {\n      if (onCreated) {\n        const result = onCreated(state.current);\n        if (result && result.then) return void result.then(activate);\n      }\n\n      activate();\n    }, []);\n    return null;\n  }, []); // Render v-dom into scene\n\n  useEffect(() => {\n    if (size.width > 0 && size.height > 0) {\n      render(createElement(stateContext.Provider, {\n        value: sharedState.current\n      }, createElement(IsReady, null), typeof children === 'function' ? children(state.current) : children), state.current.scene, state);\n    }\n  });\n  /** Sets up defaultRaycaster */\n\n  const prepareRay = useCallback(event => {\n    if (event.clientX !== void 0) {\n      const canvasRect = state.current.canvasRect;\n      const x = (event.clientX - canvasRect.left) / (canvasRect.right - canvasRect.left) * 2 - 1;\n      const y = -((event.clientY - canvasRect.top) / (canvasRect.bottom - canvasRect.top)) * 2 + 1;\n      mouse.set(x, y);\n      defaultRaycaster.setFromCamera(mouse, state.current.camera);\n    }\n  }, []);\n  /** Intersects interaction objects using the event input */\n\n  const intersect = useCallback(function (event, prepare) {\n    if (prepare === void 0) {\n      prepare = true;\n    }\n\n    if (prepare) prepareRay(event);\n    const seen = {};\n    const hits = []; // Intersect known handler objects and filter against duplicates\n\n    const intersects = defaultRaycaster.intersectObjects(state.current.scene.__interaction, true).filter(item => seen.hasOwnProperty(item.object.uuid) ? false : seen[item.object.uuid] = true);\n\n    for (let intersect of intersects) {\n      let receivingObject = intersect.object;\n      let object = intersect.object; // Bubble event up\n\n      while (object) {\n        if (object.__handlers) hits.push(_extends({}, intersect, {\n          object,\n          receivingObject\n        }));\n        object = object.parent;\n      }\n    }\n\n    return hits;\n  }, []);\n  /**  Handles intersections by forwarding them to handlers */\n\n  const handleIntersects = useCallback((event, fn) => {\n    prepareRay(event); // If the interaction is captured, take the last known hit instead of raycasting again\n\n    const hits = state.current.captured && event.type !== 'click' && event.type !== 'wheel' ? state.current.captured : intersect(event, false);\n\n    if (hits.length) {\n      const point = new Vector3(mouse.x, mouse.y, 0).unproject(state.current.camera);\n\n      for (let hit of hits) {\n        let stopped = {\n          current: false\n        };\n        fn(_extends({}, Object.assign({}, event), hit, {\n          stopped,\n          point,\n          ray: defaultRaycaster.ray,\n          // Hijack stopPropagation, which just sets a flag\n          stopPropagation: () => stopped.current = true\n        }));\n        if (stopped.current === true) break;\n      }\n    }\n\n    return hits;\n  }, []);\n  const handlePointer = useCallback(name => event => {\n    if (!state.current.ready) return;\n    handleIntersects(event, data => {\n      const object = data.object;\n      const handlers = object.__handlers;\n      if (handlers[name]) handlers[name](data);\n    });\n  }, []);\n  const hovered = useRef({});\n  const handlePointerMove = useCallback(event => {\n    if (!state.current.ready) return;\n    const hits = handleIntersects(event, data => {\n      const object = data.object;\n      const handlers = object.__handlers; // Call mouse move\n\n      if (handlers.pointerMove) handlers.pointerMove(data); // Check if mouse enter is present\n\n      if (handlers.pointerOver) {\n        if (!hovered.current[object.uuid]) {\n          // If the object wasn't previously hovered, book it and call its handler\n          hovered.current[object.uuid] = data;\n          handlers.pointerOver(_extends({}, data, {\n            type: 'pointerover'\n          }));\n        } else if (hovered.current[object.uuid].stopped.current) {\n          // If the object was previously hovered and stopped, we shouldn't allow other items to proceed\n          data.stopPropagation(); // In fact, wwe can safely remove them from the cache\n\n          Object.values(hovered.current).forEach(data => {\n            if (data.object.uuid !== object.uuid) {\n              if (data.object.__handlers.pointerOut) data.object.__handlers.pointerOut(_extends({}, data, {\n                type: 'pointerout'\n              }));\n              delete hovered.current[data.object.uuid];\n            }\n          });\n        }\n      }\n    }); // Take care of unhover\n\n    handlePointerCancel(event, hits);\n    return hits;\n  }, []);\n  const handlePointerCancel = useCallback((event, hits) => {\n    if (!hits) hits = handleIntersects(event, () => null);\n    Object.values(hovered.current).forEach(data => {\n      if (!hits.length || !hits.find(i => i.object === data.object)) {\n        if (data.object.__handlers.pointerOut) data.object.__handlers.pointerOut(_extends({}, data, {\n          type: 'pointerout'\n        }));\n        delete hovered.current[data.object.uuid];\n      }\n    });\n  }, []); // Render the canvas into the dom\n\n  return createElement(\"div\", _extends({}, bind, {\n    onClick: handlePointer('click'),\n    onWheel: handlePointer('wheel'),\n    onPointerDown: handlePointer('pointerDown'),\n    onPointerUp: handlePointer('pointerUp'),\n    onPointerLeave: event => handlePointerCancel(event, []),\n    onPointerMove: handlePointerMove // On capture intersect and remember the last known position\n    ,\n    onGotPointerCapture: event => state.current.captured = intersect(event, false) // On lost capture remove the captured hit\n    ,\n    onLostPointerCapture: event => (state.current.captured = undefined, handlePointerCancel(event))\n  }, rest, {\n    style: _extends({\n      position: 'relative',\n      width: '100%',\n      height: '100%',\n      overflow: 'hidden'\n    }, style)\n  }), createElement(\"canvas\", {\n    ref: canvas,\n    style: {\n      display: 'block'\n    }\n  }));\n});\n\nfunction useRender(fn, takeOverRenderloop) {\n  const _useContext = useContext(stateContext),\n        subscribe = _useContext.subscribe,\n        setManual = _useContext.setManual; // This calls into the host to inform it whether the render-loop is manual or not\n\n\n  useMemo(() => takeOverRenderloop && setManual(true), [takeOverRenderloop]);\n  useEffect(() => {\n    // Subscribe to the render-loop\n    const unsubscribe = subscribe(fn);\n    return () => {\n      // Call subscription off on unmount\n      unsubscribe();\n      if (takeOverRenderloop) setManual(false);\n    };\n  }, []);\n}\n\nfunction useThree() {\n  const _useContext2 = useContext(stateContext),\n        subscribe = _useContext2.subscribe,\n        props = _objectWithoutPropertiesLoose(_useContext2, [\"subscribe\"]);\n\n  return props;\n}\n\nfunction useUpdate(callback, dependents, optionalRef) {\n  const _useContext3 = useContext(stateContext),\n        invalidate = _useContext3.invalidate;\n\n  const ref = optionalRef ? optionalRef : useRef();\n  useEffect(() => {\n    callback(ref.current);\n    invalidate();\n  }, dependents);\n  return ref;\n}\n\nfunction useResource(optionalRef) {\n  const _useState = useState(),\n        resource = _useState[0],\n        set = _useState[1];\n\n  const ref = optionalRef ? optionalRef : useRef();\n  useEffect(() => void set(ref.current), [ref.current]);\n  return [ref, resource];\n}\n\nexport { Canvas, addEffect, apply, applyProps, invalidate, render, unmountComponentAtNode, useRender, useResource, useThree, useUpdate };","map":{"version":3,"sources":["/home/pablo/go/src/gitlab.com/Pablolgn/usal-cloudsubmitter/frontend/node_modules/react-three-fiber/dist/index.js"],"names":["_extends","_objectWithoutPropertiesLoose","THREE","Raycaster","Vector2","OrthographicCamera","PerspectiveCamera","WebGLRenderer","Scene","Vector3","Math","Math$1","createContext","memo","useRef","useState","useEffect","useCallback","createElement","useContext","useMemo","ResizeObserver","Reconciler","unstable_now","unstable_scheduleCallback","unstable_cancelCallback","unstable_runWithPriority","unstable_IdlePriority","_toPropertyKey","arg","key","_toPrimitive","String","input","hint","prim","Symbol","toPrimitive","undefined","res","call","TypeError","Number","roots","Map","emptyObject","is","obj","a","Object","str","num","und","arr","Array","isArray","equ","b","i","globalEffects","addEffect","callback","push","renderGl","state","time","repeat","runGlobalEffects","forEach","effect","current","frames","max","invalidateFrameloop","subscribers","fn","manual","gl","render","scene","camera","running","renderLoop","t","root","containerInfo","__state","active","ready","requestAnimationFrame","invalidate","vr","catalogue","apply","objects","applyProps","instance","newProps","oldProps","container","sameProps","keys","filter","handlers","startsWith","filteredProps","reduce","acc","prop","_","rest","map","length","entries","_ref","value","includes","target","split","set","_entries$reverse","reverse","name","reverseEntries","slice","copy","constructor","invalidateInstance","raycast","__interaction","__handlers","charAt","toLowerCase","substr","updateInstance","__container","update","createInstance","type","_ref2","_ref2$args","args","props","toUpperCase","object","__objects","appendChild","parentInstance","child","isObject3D","add","parent","attach","attachArray","attachObject","insertBefore","beforeChild","dispatchEvent","index","children","indexOf","removeChild","remove","x","dispose","Renderer","now","supportsMutation","isPrimaryRenderer","schedulePassiveEffects","cancelPassiveEffects","appendInitialChild","appendChildToContainer","removeChildFromContainer","insertInContainerBefore","commitUpdate","updatePayload","fiber","_newProps$args","argsNew","restNew","_oldProps$args","argsOld","restOld","some","newInstance","alternate","stateNode","ref","getPublicInstance","getRootHostContext","rootContainerInstance","getChildHostContext","parentHostContext","createTextInstance","finalizeInitialChildren","prepareUpdate","hostContext","shouldDeprioritizeSubtree","prepareForCommit","resetAfterCommit","shouldSetTextContent","element","get","createContainer","updateContainer","getPublicRootInstance","unmountComponentAtNode","delete","defaultRef","canvas","raycaster","mouse","size","canvasRect","aspect","viewport","captured","subscribe","setManual","takeOverRenderloop","setDefaultCamera","cam","stateContext","useMeasure","_useState","left","top","width","height","bounds","_useState2","entry","contentRect","ro","observe","disconnect","Canvas","orthographic","style","pixelRatio","_ref2$vr","_ref2$invalidateFrame","onCreated","_useState3","setReady","_useMeasure","bind","_useState4","ray","defaultRaycaster","_useState5","_useState6","position","z","defaultCam","_setDefaultCamera","s","intersect","event","handlePointerMove","sharedState","antialias","alpha","setPixelRatio","setClearAlpha","enabled","setAnimationLoop","isOrthographicCamera","factor","distance","distanceTo","fov","degToRad","tan","getBoundingClientRect","setSize","right","bottom","radius","updateProjectionMatrix","IsReady","activate","result","then","Provider","prepareRay","clientX","y","clientY","setFromCamera","prepare","seen","hits","intersects","intersectObjects","item","hasOwnProperty","uuid","receivingObject","handleIntersects","point","unproject","hit","stopped","assign","stopPropagation","handlePointer","data","hovered","pointerMove","pointerOver","values","pointerOut","handlePointerCancel","find","onClick","onWheel","onPointerDown","onPointerUp","onPointerLeave","onPointerMove","onGotPointerCapture","onLostPointerCapture","overflow","display","useRender","_useContext","unsubscribe","useThree","_useContext2","useUpdate","dependents","optionalRef","_useContext3","useResource","resource"],"mappings":"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","sourcesContent":["import _extends from '@babel/runtime/helpers/esm/extends';\nimport _objectWithoutPropertiesLoose from '@babel/runtime/helpers/esm/objectWithoutPropertiesLoose';\nimport * as THREE from 'three';\nimport { Raycaster, Vector2, OrthographicCamera, PerspectiveCamera, WebGLRenderer, Scene, Vector3, Math as Math$1 } from 'three';\nimport { createContext, memo, useRef, useState, useEffect, useCallback, createElement, useContext, useMemo } from 'react';\nimport ResizeObserver from 'resize-observer-polyfill';\nimport Reconciler from 'react-reconciler';\nimport { unstable_now, unstable_scheduleCallback, unstable_cancelCallback, unstable_runWithPriority, unstable_IdlePriority } from 'scheduler';\n\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\n\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\nconst roots = new Map();\nconst emptyObject = {};\nconst is = {\n  obj: a => a === Object(a),\n  str: a => typeof a === 'string',\n  num: a => typeof a === 'number',\n  und: a => a === void 0,\n  arr: a => Array.isArray(a),\n\n  equ(a, b) {\n    // Wrong type, doesn't match\n    if (typeof a !== typeof b) return false; // Atomic, just compare a against b\n\n    if (is.str(a) || is.num(a) || is.obj(a)) return a === b; // Array, shallow compare first to see if it's a match\n\n    if (is.arr(a) && a == b) return true; // Last resort, go through keys\n\n    let i;\n\n    for (i in a) if (!(i in b)) return false;\n\n    for (i in b) if (a[i] !== b[i]) return false;\n\n    return is.und(i) ? a === b : true;\n  }\n\n};\nlet globalEffects = [];\nfunction addEffect(callback) {\n  globalEffects.push(callback);\n}\nfunction renderGl(state, time, repeat, runGlobalEffects) {\n  if (repeat === void 0) {\n    repeat = 0;\n  }\n\n  if (runGlobalEffects === void 0) {\n    runGlobalEffects = false;\n  }\n\n  // Run global effects\n  if (runGlobalEffects) globalEffects.forEach(effect => effect(time) && repeat++); // Decrease frame count\n\n  state.current.frames = Math.max(0, state.current.frames - 1);\n  repeat += !state.current.invalidateFrameloop ? 1 : state.current.frames; // Run local effects\n\n  state.current.subscribers.forEach(fn => fn(state.current, time)); // Render content\n\n  if (!state.current.manual) state.current.gl.render(state.current.scene, state.current.camera);\n  return repeat;\n}\nlet running = false;\n\nfunction renderLoop(t) {\n  running = true;\n  let repeat = 0; // Run global effects\n\n  globalEffects.forEach(effect => effect(t) && repeat++);\n  roots.forEach(root => {\n    const state = root.containerInfo.__state; // If the frameloop is invalidated, do not run another frame\n\n    if (state.current.active && state.current.ready && (!state.current.invalidateFrameloop || state.current.frames > 0)) repeat = renderGl(state, t, repeat);\n  });\n  if (repeat !== 0) return requestAnimationFrame(renderLoop); // Flag end of operation\n\n  running = false;\n}\n\nfunction invalidate(state, frames) {\n  if (frames === void 0) {\n    frames = 1;\n  }\n\n  if (state && state.current) {\n    if (state.current.vr) return;\n    state.current.frames = frames;\n  } else if (state === true) roots.forEach(root => root.containerInfo.__state.current.frames = frames);\n\n  if (!running) {\n    running = true;\n    requestAnimationFrame(renderLoop);\n  }\n}\nlet catalogue = {};\nconst apply = objects => catalogue = _extends({}, catalogue, objects);\nfunction applyProps(instance, newProps, oldProps, container) {\n  if (oldProps === void 0) {\n    oldProps = {};\n  }\n\n  // Filter equals, events and reserved props\n  const sameProps = Object.keys(newProps).filter(key => is.equ(newProps[key], oldProps[key]));\n  const handlers = Object.keys(newProps).filter(key => typeof newProps[key] === 'function' && key.startsWith('on'));\n  const filteredProps = [...sameProps, 'children', 'key', 'ref'].reduce((acc, prop) => {\n    let _ = acc[prop],\n        rest = _objectWithoutPropertiesLoose(acc, [prop].map(_toPropertyKey));\n\n    return rest;\n  }, newProps);\n\n  if (Object.keys(filteredProps).length > 0) {\n    Object.entries(filteredProps).forEach((_ref) => {\n      let key = _ref[0],\n          value = _ref[1];\n\n      if (!handlers.includes(key)) {\n        let root = instance;\n        let target = root[key];\n\n        if (key.includes('-')) {\n          const entries = key.split('-');\n          target = entries.reduce((acc, key) => acc[key], instance); // If the target is atomic, it forces us to switch the root\n\n          if (!(target && target.set)) {\n            const _entries$reverse = entries.reverse(),\n                  name = _entries$reverse[0],\n                  reverseEntries = _entries$reverse.slice(1);\n\n            root = reverseEntries.reverse().reduce((acc, key) => acc[key], instance);\n            key = name;\n          }\n        } // Special treatment for objects with support for set/copy\n\n\n        if (target && target.set && target.copy) {\n          if (target.constructor.name === value.constructor.name) target.copy(value);else if (Array.isArray(value)) target.set(...value);else target.set(value); // Else, just overwrite the value\n        } else root[key] = value;\n\n        invalidateInstance(instance);\n      }\n    }); // Prep interaction handlers\n\n    if (handlers.length) {\n      // Add interactive object to central container\n      if (container && instance.raycast && !(handlers.length === 1 && handlers[0] === 'onUpdate')) {\n        container.__interaction.push(instance);\n      }\n\n      instance.__handlers = handlers.reduce((acc, key) => _extends({}, acc, {\n        [key.charAt(2).toLowerCase() + key.substr(3)]: newProps[key]\n      }), {});\n    } // Call the update lifecycle when it is being updated\n\n\n    if (!container) updateInstance(instance);\n  }\n}\n\nfunction invalidateInstance(instance) {\n  if (instance.__container && instance.__container.__state) invalidate(instance.__container.__state);\n}\n\nfunction updateInstance(instance) {\n  if (instance.__handlers && instance.__handlers.update) instance.__handlers.update(instance);\n}\n\nfunction createInstance(type, _ref2, container) {\n  let _ref2$args = _ref2.args,\n      args = _ref2$args === void 0 ? [] : _ref2$args,\n      props = _objectWithoutPropertiesLoose(_ref2, [\"args\"]);\n\n  let name = \"\" + type[0].toUpperCase() + type.slice(1);\n  let instance;\n  if (type === 'primitive') instance = props.object;else {\n    const target = catalogue[name] || THREE[name];\n    instance = is.arr(args) ? new target(...args) : new target(args);\n  } // Apply initial props\n\n  instance.__objects = [];\n  instance.__container = container;\n  applyProps(instance, props, {}, container);\n  return instance;\n}\n\nfunction appendChild(parentInstance, child) {\n  if (child) {\n    if (child.isObject3D) parentInstance.add(child);else {\n      parentInstance.__objects.push(child);\n\n      child.parent = parentInstance; // The attach attribute implies that the object attaches itself on the parent\n\n      if (child.attach) parentInstance[child.attach] = child;else if (child.attachArray) {\n        if (!is.arr(parentInstance[child.attachArray])) parentInstance[child.attachArray] = [];\n        parentInstance[child.attachArray].push(child);\n      } else if (child.attachObject) {\n        if (!is.obj(parentInstance[child.attachObject[0]])) parentInstance[child.attachObject[0]] = {};\n        parentInstance[child.attachObject[0]][child.attachObject[1]] = child;\n      }\n    }\n    updateInstance(child);\n    invalidateInstance(child);\n  }\n}\n\nfunction insertBefore(parentInstance, child, beforeChild) {\n  if (child) {\n    if (child.isObject3D) {\n      child.parent = parentInstance;\n      child.dispatchEvent({\n        type: 'added'\n      }); // TODO: the order is out of whack if data objects are present, has to be recalculated\n\n      const index = parentInstance.children.indexOf(beforeChild);\n      parentInstance.children = [...parentInstance.children.slice(0, index), child, ...parentInstance.children.slice(index)];\n      updateInstance(child);\n    } else appendChild(parentInstance, child); // TODO: order!!!\n\n\n    invalidateInstance(child);\n  }\n}\n\nfunction removeChild(parentInstance, child) {\n  if (child) {\n    if (child.isObject3D) {\n      parentInstance.remove(child);\n    } else {\n      child.parent = undefined;\n      parentInstance.__objects = parentInstance.__objects.filter(x => x !== child); // Remove attachment\n\n      if (child.attach) parentInstance[child.attach] = undefined;else if (child.attachArray) parentInstance[child.attachArray] = parentInstance[child.attachArray].filter(x => x !== child);else if (child.attachObject) parentInstance[child.attachObject[0]][child.attachObject[1]] = undefined;\n    }\n\n    invalidateInstance(child);\n    unstable_runWithPriority(unstable_IdlePriority, () => {\n      // Remove interactivity\n      if (child.__container) child.__container.__interaction = child.__container.__interaction.filter(x => x !== child); // Remove nested child objects\n\n      if (child.__objects) child.__objects.forEach(obj => removeChild(child, obj));\n      if (child.children) child.children.forEach(obj => removeChild(child, obj)); // Dispose item\n\n      if (child.dispose) child.dispose(); // Remove references\n\n      delete child.__container;\n      delete child.__objects;\n    });\n  }\n}\n\nconst Renderer = Reconciler({\n  now: unstable_now,\n  createInstance,\n  removeChild,\n  appendChild,\n  insertBefore,\n  supportsMutation: true,\n  isPrimaryRenderer: false,\n  schedulePassiveEffects: unstable_scheduleCallback,\n  cancelPassiveEffects: unstable_cancelCallback,\n  appendInitialChild: appendChild,\n  appendChildToContainer: appendChild,\n  removeChildFromContainer: removeChild,\n  insertInContainerBefore: insertBefore,\n\n  commitUpdate(instance, updatePayload, type, oldProps, newProps, fiber) {\n    if (instance.isObject3D) {\n      applyProps(instance, newProps, oldProps);\n    } else {\n      // This is a data object, let's extract critical information about it\n      const parent = instance.parent;\n\n      const _newProps$args = newProps.args,\n            argsNew = _newProps$args === void 0 ? [] : _newProps$args,\n            restNew = _objectWithoutPropertiesLoose(newProps, [\"args\"]);\n\n      const _oldProps$args = oldProps.args,\n            argsOld = _oldProps$args === void 0 ? [] : _oldProps$args,\n            restOld = _objectWithoutPropertiesLoose(oldProps, [\"args\"]); // If it has new props or arguments, then it needs to be re-instanciated\n      // TODO, are colors falsely detected here?\n\n\n      if (argsNew.some((value, index) => value !== argsOld[index])) {\n        // Next we create a new instance and append it again\n        const newInstance = createInstance(type, newProps, instance.__container);\n        removeChild(parent, instance);\n        appendChild(parent, newInstance) // This evil hack switches the react-internal fiber node\n        // https://github.com/facebook/react/issues/14983\n        // https://github.com/facebook/react/pull/15021\n        ;\n        [fiber, fiber.alternate].forEach(fiber => {\n          if (fiber !== null) {\n            fiber.stateNode = newInstance;\n\n            if (fiber.ref) {\n              if (typeof fiber.ref === 'function') fiber.ref(newInstance);else fiber.ref.current = newInstance;\n            }\n          }\n        });\n      } else {\n        // Otherwise just overwrite props\n        applyProps(instance, restNew, restOld);\n      }\n    }\n  },\n\n  getPublicInstance(instance) {\n    return instance;\n  },\n\n  getRootHostContext(rootContainerInstance) {\n    return emptyObject;\n  },\n\n  getChildHostContext(parentHostContext, type) {\n    return emptyObject;\n  },\n\n  createTextInstance() {},\n\n  finalizeInitialChildren(instance, type, props, rootContainerInstance) {\n    return false;\n  },\n\n  prepareUpdate(instance, type, oldProps, newProps, rootContainerInstance, hostContext) {\n    return emptyObject;\n  },\n\n  shouldDeprioritizeSubtree(type, props) {\n    return false;\n  },\n\n  prepareForCommit() {},\n\n  resetAfterCommit() {},\n\n  shouldSetTextContent(props) {\n    return false;\n  }\n\n});\nfunction render(element, container, state) {\n  let root = roots.get(container);\n\n  if (!root) {\n    root = Renderer.createContainer(container);\n    container.__state = state;\n    roots.set(container, root);\n  }\n\n  Renderer.updateContainer(element, root, null, undefined);\n  return Renderer.getPublicRootInstance(root);\n}\nfunction unmountComponentAtNode(container) {\n  const root = roots.get(container);\n  if (root) Renderer.updateContainer(null, root, null, () => roots.delete(container));\n}\n\nconst defaultRef = {\n  ready: false,\n  subscribers: [],\n  manual: false,\n  vr: false,\n  active: true,\n  canvas: undefined,\n  gl: undefined,\n  camera: undefined,\n  raycaster: undefined,\n  mouse: undefined,\n  scene: undefined,\n  size: undefined,\n  canvasRect: undefined,\n  frames: 0,\n  aspect: 0,\n  viewport: undefined,\n  captured: undefined,\n  invalidateFrameloop: false,\n  subscribe: fn => () => {},\n  setManual: takeOverRenderloop => {},\n  setDefaultCamera: cam => {},\n  invalidate: () => {}\n};\nconst stateContext = createContext(defaultRef);\n\nfunction useMeasure() {\n  const ref = useRef();\n\n  const _useState = useState({\n    left: 0,\n    top: 0,\n    width: 0,\n    height: 0\n  }),\n        bounds = _useState[0],\n        set = _useState[1];\n\n  const _useState2 = useState(() => new ResizeObserver((_ref) => {\n    let entry = _ref[0];\n    return set(entry.contentRect);\n  })),\n        ro = _useState2[0];\n\n  useEffect(() => {\n    if (ref.current) ro.observe(ref.current);\n    return () => ro.disconnect();\n  }, [ref.current]);\n  return [{\n    ref\n  }, bounds];\n}\n\nconst Canvas = memo((_ref2) => {\n  let children = _ref2.children,\n      gl = _ref2.gl,\n      camera = _ref2.camera,\n      orthographic = _ref2.orthographic,\n      raycaster = _ref2.raycaster,\n      style = _ref2.style,\n      pixelRatio = _ref2.pixelRatio,\n      _ref2$vr = _ref2.vr,\n      vr = _ref2$vr === void 0 ? false : _ref2$vr,\n      _ref2$invalidateFrame = _ref2.invalidateFrameloop,\n      invalidateFrameloop = _ref2$invalidateFrame === void 0 ? false : _ref2$invalidateFrame,\n      onCreated = _ref2.onCreated,\n      rest = _objectWithoutPropertiesLoose(_ref2, [\"children\", \"gl\", \"camera\", \"orthographic\", \"raycaster\", \"style\", \"pixelRatio\", \"vr\", \"invalidateFrameloop\", \"onCreated\"]);\n\n  // Local, reactive state\n  const canvas = useRef();\n\n  const _useState3 = useState(false),\n        ready = _useState3[0],\n        setReady = _useState3[1];\n\n  const _useMeasure = useMeasure(),\n        bind = _useMeasure[0],\n        size = _useMeasure[1];\n\n  const _useState4 = useState(() => {\n    const ray = new Raycaster();\n    if (raycaster) applyProps(ray, raycaster, {});\n    return ray;\n  }),\n        defaultRaycaster = _useState4[0];\n\n  const _useState5 = useState(() => new Vector2()),\n        mouse = _useState5[0];\n\n  const _useState6 = useState(() => {\n    const cam = orthographic ? new OrthographicCamera(0, 0, 0, 0, 0.1, 1000) : new PerspectiveCamera(75, 0, 0.1, 1000);\n    cam.position.z = 5;\n    if (camera) applyProps(cam, camera, {});\n    return cam;\n  }),\n        defaultCam = _useState6[0],\n        _setDefaultCamera = _useState6[1]; // Public state\n\n\n  const state = useRef(_extends({}, defaultRef, {\n    subscribe: fn => {\n      state.current.subscribers.push(fn);\n      return () => state.current.subscribers = state.current.subscribers.filter(s => s !== fn);\n    },\n    setManual: takeOverRenderloop => {\n      state.current.manual = takeOverRenderloop;\n\n      if (takeOverRenderloop) {\n        // In manual mode items shouldn't really be part of the internal scene which has adverse effects\n        // on the camera being unable to update without explicit calls to updateMatrixWorl()\n        state.current.scene.children.forEach(child => state.current.scene.remove(child));\n      }\n    },\n    setDefaultCamera: cam => {\n      state.current.camera = cam;\n\n      _setDefaultCamera(cam);\n    },\n    invalidate: () => invalidate(state),\n    intersect: function intersect(event) {\n      if (event === void 0) {\n        event = {};\n      }\n\n      return handlePointerMove(event);\n    }\n  })); // This is used as a clone of the current state, to be distributed through context and useThree\n\n  const sharedState = useRef(state.current); // Writes locals into public state for distribution among subscribers, context, etc\n\n  useEffect(() => {\n    state.current.ready = ready;\n    state.current.size = size;\n    state.current.camera = defaultCam;\n    state.current.invalidateFrameloop = invalidateFrameloop;\n    state.current.vr = vr;\n    state.current.raycaster = defaultRaycaster;\n    state.current.mouse = mouse;\n  }, [invalidateFrameloop, vr, ready, size, defaultCam]); // Component mount effect, creates the webGL render context\n\n  useEffect(() => {\n    state.current.gl = new WebGLRenderer(_extends({\n      canvas: canvas.current,\n      antialias: true,\n      alpha: true\n    }, gl));\n    if (pixelRatio) state.current.gl.setPixelRatio(pixelRatio);\n    state.current.gl.setClearAlpha(0);\n    state.current.canvas = canvas.current;\n    state.current.scene = new Scene();\n    state.current.scene.__interaction = [];\n    state.current.scene.__objects = []; // Start render-loop, either via RAF or setAnimationLoop for VR\n\n    if (!state.current.vr) invalidate(state);else {\n      state.current.gl.vr.enabled = true;\n      state.current.gl.setAnimationLoop(t => renderGl(state, t, 0, true));\n    } // Clean-up\n\n    return () => {\n      state.current.gl.dispose();\n      state.current.active = false;\n      unmountComponentAtNode(state.current.scene);\n    };\n  }, []); // Adjusts default camera\n\n  useEffect(() => {\n    state.current.aspect = size.width / size.height || 0;\n\n    if (state.current.camera.isOrthographicCamera) {\n      state.current.viewport = {\n        width: size.width,\n        height: size.height,\n        factor: 1\n      };\n    } else {\n      const target = new Vector3(0, 0, 0);\n      const distance = state.current.camera.position.distanceTo(target);\n      const fov = Math$1.degToRad(state.current.camera.fov); // convert vertical fov to radians\n\n      const height = 2 * Math.tan(fov / 2) * distance; // visible height\n\n      const width = height * state.current.aspect;\n      state.current.viewport = {\n        width,\n        height,\n        factor: size.width / width\n      };\n    }\n\n    state.current.canvasRect = bind.ref.current.getBoundingClientRect();\n\n    if (ready) {\n      state.current.gl.setSize(size.width, size.height);\n\n      if (state.current.camera.isOrthographicCamera) {\n        state.current.camera.left = size.width / -2;\n        state.current.camera.right = size.width / 2;\n        state.current.camera.top = size.height / 2;\n        state.current.camera.bottom = size.height / -2;\n      } else {\n        state.current.camera.aspect = state.current.aspect;\n        state.current.camera.radius = (size.width + size.height) / 4;\n      }\n\n      state.current.camera.updateProjectionMatrix();\n\n      invalidate(state);\n    } // Only trigger the context provider when necessary\n\n\n    sharedState.current = _extends({}, state.current);\n  }, [ready, size, defaultCam]); // This component is a bridge into the three render context, when it gets rendererd\n  // we know we are ready to compile shaders, call subscribers, etc\n\n  const IsReady = useCallback(() => {\n    const activate = useCallback(() => void (setReady(true), invalidate(state)), []);\n    useEffect(() => {\n      if (onCreated) {\n        const result = onCreated(state.current);\n        if (result && result.then) return void result.then(activate);\n      }\n\n      activate();\n    }, []);\n    return null;\n  }, []); // Render v-dom into scene\n\n  useEffect(() => {\n    if (size.width > 0 && size.height > 0) {\n      render(createElement(stateContext.Provider, {\n        value: sharedState.current\n      }, createElement(IsReady, null), typeof children === 'function' ? children(state.current) : children), state.current.scene, state);\n    }\n  });\n  /** Sets up defaultRaycaster */\n\n  const prepareRay = useCallback(event => {\n    if (event.clientX !== void 0) {\n      const canvasRect = state.current.canvasRect;\n      const x = (event.clientX - canvasRect.left) / (canvasRect.right - canvasRect.left) * 2 - 1;\n      const y = -((event.clientY - canvasRect.top) / (canvasRect.bottom - canvasRect.top)) * 2 + 1;\n      mouse.set(x, y);\n      defaultRaycaster.setFromCamera(mouse, state.current.camera);\n    }\n  }, []);\n  /** Intersects interaction objects using the event input */\n\n  const intersect = useCallback(function (event, prepare) {\n    if (prepare === void 0) {\n      prepare = true;\n    }\n\n    if (prepare) prepareRay(event);\n    const seen = {};\n    const hits = []; // Intersect known handler objects and filter against duplicates\n\n    const intersects = defaultRaycaster.intersectObjects(state.current.scene.__interaction, true).filter(item => seen.hasOwnProperty(item.object.uuid) ? false : seen[item.object.uuid] = true);\n\n    for (let intersect of intersects) {\n      let receivingObject = intersect.object;\n      let object = intersect.object; // Bubble event up\n\n      while (object) {\n        if (object.__handlers) hits.push(_extends({}, intersect, {\n          object,\n          receivingObject\n        }));\n        object = object.parent;\n      }\n    }\n\n    return hits;\n  }, []);\n  /**  Handles intersections by forwarding them to handlers */\n\n  const handleIntersects = useCallback((event, fn) => {\n    prepareRay(event); // If the interaction is captured, take the last known hit instead of raycasting again\n\n    const hits = state.current.captured && event.type !== 'click' && event.type !== 'wheel' ? state.current.captured : intersect(event, false);\n\n    if (hits.length) {\n      const point = new Vector3(mouse.x, mouse.y, 0).unproject(state.current.camera);\n\n      for (let hit of hits) {\n        let stopped = {\n          current: false\n        };\n        fn(_extends({}, Object.assign({}, event), hit, {\n          stopped,\n          point,\n          ray: defaultRaycaster.ray,\n          // Hijack stopPropagation, which just sets a flag\n          stopPropagation: () => stopped.current = true\n        }));\n        if (stopped.current === true) break;\n      }\n    }\n\n    return hits;\n  }, []);\n  const handlePointer = useCallback(name => event => {\n    if (!state.current.ready) return;\n    handleIntersects(event, data => {\n      const object = data.object;\n      const handlers = object.__handlers;\n      if (handlers[name]) handlers[name](data);\n    });\n  }, []);\n  const hovered = useRef({});\n  const handlePointerMove = useCallback(event => {\n    if (!state.current.ready) return;\n    const hits = handleIntersects(event, data => {\n      const object = data.object;\n      const handlers = object.__handlers; // Call mouse move\n\n      if (handlers.pointerMove) handlers.pointerMove(data); // Check if mouse enter is present\n\n      if (handlers.pointerOver) {\n        if (!hovered.current[object.uuid]) {\n          // If the object wasn't previously hovered, book it and call its handler\n          hovered.current[object.uuid] = data;\n          handlers.pointerOver(_extends({}, data, {\n            type: 'pointerover'\n          }));\n        } else if (hovered.current[object.uuid].stopped.current) {\n          // If the object was previously hovered and stopped, we shouldn't allow other items to proceed\n          data.stopPropagation(); // In fact, wwe can safely remove them from the cache\n\n          Object.values(hovered.current).forEach(data => {\n            if (data.object.uuid !== object.uuid) {\n              if (data.object.__handlers.pointerOut) data.object.__handlers.pointerOut(_extends({}, data, {\n                type: 'pointerout'\n              }));\n              delete hovered.current[data.object.uuid];\n            }\n          });\n        }\n      }\n    }); // Take care of unhover\n\n    handlePointerCancel(event, hits);\n    return hits;\n  }, []);\n  const handlePointerCancel = useCallback((event, hits) => {\n    if (!hits) hits = handleIntersects(event, () => null);\n    Object.values(hovered.current).forEach(data => {\n      if (!hits.length || !hits.find(i => i.object === data.object)) {\n        if (data.object.__handlers.pointerOut) data.object.__handlers.pointerOut(_extends({}, data, {\n          type: 'pointerout'\n        }));\n        delete hovered.current[data.object.uuid];\n      }\n    });\n  }, []); // Render the canvas into the dom\n\n  return createElement(\"div\", _extends({}, bind, {\n    onClick: handlePointer('click'),\n    onWheel: handlePointer('wheel'),\n    onPointerDown: handlePointer('pointerDown'),\n    onPointerUp: handlePointer('pointerUp'),\n    onPointerLeave: event => handlePointerCancel(event, []),\n    onPointerMove: handlePointerMove // On capture intersect and remember the last known position\n    ,\n    onGotPointerCapture: event => state.current.captured = intersect(event, false) // On lost capture remove the captured hit\n    ,\n    onLostPointerCapture: event => (state.current.captured = undefined, handlePointerCancel(event))\n  }, rest, {\n    style: _extends({\n      position: 'relative',\n      width: '100%',\n      height: '100%',\n      overflow: 'hidden'\n    }, style)\n  }), createElement(\"canvas\", {\n    ref: canvas,\n    style: {\n      display: 'block'\n    }\n  }));\n});\n\nfunction useRender(fn, takeOverRenderloop) {\n  const _useContext = useContext(stateContext),\n        subscribe = _useContext.subscribe,\n        setManual = _useContext.setManual; // This calls into the host to inform it whether the render-loop is manual or not\n\n\n  useMemo(() => takeOverRenderloop && setManual(true), [takeOverRenderloop]);\n  useEffect(() => {\n    // Subscribe to the render-loop\n    const unsubscribe = subscribe(fn);\n    return () => {\n      // Call subscription off on unmount\n      unsubscribe();\n      if (takeOverRenderloop) setManual(false);\n    };\n  }, []);\n}\nfunction useThree() {\n  const _useContext2 = useContext(stateContext),\n        subscribe = _useContext2.subscribe,\n        props = _objectWithoutPropertiesLoose(_useContext2, [\"subscribe\"]);\n\n  return props;\n}\nfunction useUpdate(callback, dependents, optionalRef) {\n  const _useContext3 = useContext(stateContext),\n        invalidate = _useContext3.invalidate;\n\n  const ref = optionalRef ? optionalRef : useRef();\n  useEffect(() => {\n    callback(ref.current);\n    invalidate();\n  }, dependents);\n  return ref;\n}\nfunction useResource(optionalRef) {\n  const _useState = useState(),\n        resource = _useState[0],\n        set = _useState[1];\n\n  const ref = optionalRef ? optionalRef : useRef();\n  useEffect(() => void set(ref.current), [ref.current]);\n  return [ref, resource];\n}\n\nexport { Canvas, addEffect, apply, applyProps, invalidate, render, unmountComponentAtNode, useRender, useResource, useThree, useUpdate };\n"]},"metadata":{},"sourceType":"module"}