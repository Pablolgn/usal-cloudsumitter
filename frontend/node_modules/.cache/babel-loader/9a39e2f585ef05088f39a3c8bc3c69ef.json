{"ast":null,"code":"var _jsxFileName = \"/home/pablo/go/src/gitlab.com/Pablolgn/usal-cloudsubmitter/frontend/src/components/Preview.js\";\nimport React, { useRef, useEffect, useState } from 'react';\nimport * as THREE from 'three';\nimport { STLLoader } from './jsm/loaders/STLLoader.js';\n\nfunction Preview() {\n  const mount = useRef(null);\n  const [isAnimating, setAnimating] = useState(true);\n  const controls = useRef(null);\n  useEffect(() => {\n    let width = mount.current.clientWidth;\n    let height = mount.current.clientHeight;\n    let frameId;\n    const scene = new THREE.Scene();\n    const camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000);\n    const renderer = new THREE.WebGLRenderer({\n      antialias: true\n    });\n    const geometry = new THREE.BoxGeometry(1, 1, 1);\n    const material = new THREE.MeshBasicMaterial({\n      color: 0x464448\n    });\n    const cube = new THREE.Mesh(geometry, material);\n    camera.position.z = 4;\n    scene.add(cube);\n    renderer.setClearColor('#000000');\n    renderer.setSize(width, height);\n    var loader = new STLLoader();\n    loader.load('./models/gear.stl', function (geometry) {\n      var material = new THREE.MeshPhongMaterial({\n        color: 0xff5533,\n        specular: 0x111111,\n        shininess: 200\n      });\n      var mesh = new THREE.Mesh(geometry, material);\n      mesh.position.set(0, -0.25, 0.6);\n      mesh.rotation.set(0, -Math.PI / 2, 0);\n      mesh.scale.set(0.5, 0.5, 0.5);\n      mesh.castShadow = true;\n      mesh.receiveShadow = true;\n      scene.add(mesh);\n    });\n\n    const renderScene = () => {\n      renderer.render(scene, camera);\n    };\n\n    const handleResize = () => {\n      width = mount.current.clientWidth;\n      height = mount.current.clientHeight;\n      renderer.setSize(width, height);\n      camera.aspect = width / height;\n      camera.updateProjectionMatrix();\n      renderScene();\n    };\n\n    const animate = () => {\n      cube.rotation.x += 0.01;\n      cube.rotation.y += 0.01;\n      renderScene();\n      frameId = window.requestAnimationFrame(animate);\n    };\n\n    const start = () => {\n      if (!frameId) {\n        frameId = requestAnimationFrame(animate);\n      }\n    };\n\n    const stop = () => {\n      cancelAnimationFrame(frameId);\n      frameId = null;\n    };\n\n    mount.current.appendChild(renderer.domElement);\n    window.addEventListener('resize', handleResize);\n    start();\n    controls.current = {\n      start,\n      stop\n    };\n    return () => {\n      stop();\n      window.removeEventListener('resize', handleResize);\n      mount.current.removeChild(renderer.domElement);\n      scene.remove(cube);\n      geometry.dispose();\n      material.dispose();\n    };\n  }, []);\n  useEffect(() => {\n    if (isAnimating) {\n      controls.current.start();\n    } else {\n      controls.current.stop();\n    }\n  }, [isAnimating]);\n  return React.createElement(\"div\", {\n    className: \"vis\",\n    ref: mount,\n    onClick: () => setAnimating(!isAnimating),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103\n    },\n    __self: this\n  });\n}\n\nexport default Preview;","map":{"version":3,"sources":["/home/pablo/go/src/gitlab.com/Pablolgn/usal-cloudsubmitter/frontend/src/components/Preview.js"],"names":["React","useRef","useEffect","useState","THREE","STLLoader","Preview","mount","isAnimating","setAnimating","controls","width","current","clientWidth","height","clientHeight","frameId","scene","Scene","camera","PerspectiveCamera","renderer","WebGLRenderer","antialias","geometry","BoxGeometry","material","MeshBasicMaterial","color","cube","Mesh","position","z","add","setClearColor","setSize","loader","load","MeshPhongMaterial","specular","shininess","mesh","set","rotation","Math","PI","scale","castShadow","receiveShadow","renderScene","render","handleResize","aspect","updateProjectionMatrix","animate","x","y","window","requestAnimationFrame","start","stop","cancelAnimationFrame","appendChild","domElement","addEventListener","removeEventListener","removeChild","remove","dispose"],"mappings":"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","sourcesContent":["import React, { useRef, useEffect, useState } from 'react';\nimport * as THREE from 'three'\nimport { STLLoader } from './jsm/loaders/STLLoader.js';\n\n\nfunction Preview(){\n\n  const mount = useRef(null)\n  const [isAnimating, setAnimating] = useState(true)\n  const controls = useRef(null)\n  \n  useEffect(() => {\n    let width = mount.current.clientWidth\n    let height = mount.current.clientHeight\n    let frameId\n\n    const scene = new THREE.Scene()\n    const camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000)\n    const renderer = new THREE.WebGLRenderer({ antialias: true })\n    const geometry = new THREE.BoxGeometry(1, 1, 1)\n    const material = new THREE.MeshBasicMaterial({ color: 0x464448})\n    const cube = new THREE.Mesh(geometry, material)\n\n    camera.position.z = 4\n    scene.add(cube)\n    renderer.setClearColor('#000000')\n    renderer.setSize(width, height)\n\n    var loader = new STLLoader();\n    loader.load( './models/gear.stl', function ( geometry ) {\n\n      var material = new THREE.MeshPhongMaterial( { color: 0xff5533, specular: 0x111111, shininess: 200 } );\n      var mesh = new THREE.Mesh( geometry, material );\n\n      mesh.position.set( 0, - 0.25, 0.6 );\n      mesh.rotation.set( 0, - Math.PI / 2, 0 );\n      mesh.scale.set( 0.5, 0.5, 0.5 );\n\n      mesh.castShadow = true;\n      mesh.receiveShadow = true;\n\n      scene.add( mesh );\n\n    } );\n\n    const renderScene = () => {\n      renderer.render(scene, camera)\n    }\n\n    const handleResize = () => {\n      width = mount.current.clientWidth\n      height = mount.current.clientHeight\n      renderer.setSize(width, height)\n      camera.aspect = width / height\n      camera.updateProjectionMatrix()\n      renderScene()\n    }\n    \n    const animate = () => {\n      cube.rotation.x += 0.01\n      cube.rotation.y += 0.01\n\n      renderScene()\n      frameId = window.requestAnimationFrame(animate)\n    }\n\n    const start = () => {\n      if (!frameId) {\n        frameId = requestAnimationFrame(animate)\n      }\n    }\n\n    const stop = () => {\n      cancelAnimationFrame(frameId)\n      frameId = null\n    }\n\n    mount.current.appendChild(renderer.domElement)\n    window.addEventListener('resize', handleResize)\n    start()\n\n    controls.current = { start, stop }\n    \n    return () => {\n      stop()\n      window.removeEventListener('resize', handleResize)\n      mount.current.removeChild(renderer.domElement)\n\n      scene.remove(cube)\n      geometry.dispose()\n      material.dispose()\n    }\n  }, [])\n\n  useEffect(() => {\n    if (isAnimating) {\n      controls.current.start()\n    } else {\n      controls.current.stop()\n    }\n  }, [isAnimating])\n  \n  return <div className=\"vis\" ref={mount} onClick={() => setAnimating(!isAnimating)} />\n}\nexport default Preview;"]},"metadata":{},"sourceType":"module"}