{"ast":null,"code":"import _extends from '@babel/runtime/helpers/esm/extends';\nimport _objectWithoutPropertiesLoose from '@babel/runtime/helpers/esm/objectWithoutPropertiesLoose';\nimport * as THREE from 'three';\nimport { Layers, Vector2, Raycaster, Scene, OrthographicCamera, PerspectiveCamera, Clock, Vector3, PCFSoftShadowMap, ACESFilmicToneMapping, sRGBEncoding, WebGLRenderer } from 'three';\nimport Reconciler from 'react-reconciler';\nimport { unstable_now, unstable_runWithPriority, unstable_IdlePriority } from 'scheduler';\nimport React__default, { createContext, useState, useRef, useMemo, useCallback, useLayoutEffect, useEffect, createElement, useContext as useContext$1 } from 'react';\nimport { TinyEmitter } from 'tiny-emitter';\nimport usePromise from 'react-promise-suspense';\nimport ReactDOM from 'react-dom';\nimport useMeasure from 'react-use-measure';\nimport { ResizeObserver } from '@juggle/resize-observer';\nimport mergeRefs from 'react-merge-refs';\nvar version = \"4.0.26\";\n\nfunction _toPropertyKey(arg) {\n  var key = _toPrimitive(arg, \"string\");\n\n  return typeof key === \"symbol\" ? key : String(key);\n}\n\nfunction _toPrimitive(input, hint) {\n  if (typeof input !== \"object\" || input === null) return input;\n  var prim = input[Symbol.toPrimitive];\n\n  if (prim !== undefined) {\n    var res = prim.call(input, hint || \"default\");\n    if (typeof res !== \"object\") return res;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n\n  return (hint === \"string\" ? String : Number)(input);\n}\n\nconst roots = new Map();\nconst emptyObject = {};\nconst is = {\n  obj: a => a === Object(a) && !is.arr(a),\n  fun: a => typeof a === 'function',\n  str: a => typeof a === 'string',\n  num: a => typeof a === 'number',\n  und: a => a === void 0,\n  arr: a => Array.isArray(a),\n\n  equ(a, b) {\n    // Wrong type or one of the two undefined, doesn't match\n    if (typeof a !== typeof b || !!a !== !!b) return false; // Atomic, just compare a against b\n\n    if (is.str(a) || is.num(a) || is.obj(a)) return a === b; // Array, shallow compare first to see if it's a match\n\n    if (is.arr(a) && a == b) return true; // Last resort, go through keys\n\n    let i;\n\n    for (i in a) if (!(i in b)) return false;\n\n    for (i in b) if (a[i] !== b[i]) return false;\n\n    return is.und(i) ? a === b : true;\n  }\n\n};\n\nfunction createSubs(callback, subs) {\n  const index = subs.length;\n  subs.push(callback);\n  return () => void subs.splice(index, 1);\n}\n\nlet globalEffects = [];\nlet globalTailEffects = [];\n\nconst addEffect = callback => createSubs(callback, globalEffects);\n\nconst addTail = callback => createSubs(callback, globalTailEffects);\n\nfunction renderGl(state, timestamp, repeat = 0, runGlobalEffects = false) {\n  // Run global effects\n  if (runGlobalEffects) globalEffects.forEach(effect => effect(timestamp) && repeat++); // Run local effects\n\n  const delta = state.current.clock.getDelta();\n  state.current.subscribers.forEach(sub => sub.ref.current(state.current, delta)); // Decrease frame count\n\n  state.current.frames = Math.max(0, state.current.frames - 1);\n  repeat += !state.current.invalidateFrameloop ? 1 : state.current.frames; // Render content\n\n  if (!state.current.manual) state.current.gl.render(state.current.scene, state.current.camera);\n  return repeat;\n}\n\nlet running = false;\n\nfunction renderLoop(timestamp) {\n  running = true;\n  let repeat = 0; // Run global effects\n\n  globalEffects.forEach(effect => effect(timestamp) && repeat++);\n  roots.forEach(root => {\n    const state = root.containerInfo.__state; // If the frameloop is invalidated, do not run another frame\n\n    if (state.current.active && state.current.ready && (!state.current.invalidateFrameloop || state.current.frames > 0)) repeat = renderGl(state, timestamp, repeat);\n  });\n  if (repeat !== 0) return requestAnimationFrame(renderLoop);else {\n    // Tail call effects, they are called when rendering stops\n    globalTailEffects.forEach(effect => effect(timestamp));\n  } // Flag end of operation\n\n  running = false;\n}\n\nfunction invalidate(state = true, frames = 2) {\n  if (state === true) roots.forEach(root => root.containerInfo.__state.current.frames = frames);else if (state && state.current) {\n    if (state.current.vr) return;\n    state.current.frames = frames;\n  }\n\n  if (!running) {\n    running = true;\n    requestAnimationFrame(renderLoop);\n  }\n}\n\nlet catalogue = {};\n\nconst extend = objects => void (catalogue = _extends({}, catalogue, {}, objects));\n\nfunction applyProps(instance, newProps, oldProps = {}, accumulative = false) {\n  // Filter equals, events and reserved props\n  const container = instance.__container;\n  const sameProps = Object.keys(newProps).filter(key => is.equ(newProps[key], oldProps[key]));\n  const handlers = Object.keys(newProps).filter(key => {\n    // Event-handlers ...\n    //   are functions, that\n    //   start with \"on\", and\n    //   contain the name \"pointer\", or \"wheel\", or \"click\"\n    if (is.fun(newProps[key]) && key.startsWith('on')) {\n      return key.includes('Pointer') || key.includes('Click') || key.includes('Wheel');\n    }\n  });\n  const leftOvers = accumulative ? Object.keys(oldProps).filter(key => newProps[key] === void 0) : [];\n  const filteredProps = [...sameProps, 'children', 'key', 'ref'].reduce((acc, prop) => {\n    let rest = _objectWithoutPropertiesLoose(acc, [prop].map(_toPropertyKey));\n\n    return rest;\n  }, newProps); // Add left-overs as undefined props so they can be removed\n\n  leftOvers.forEach(key => key !== 'children' && (filteredProps[key] = undefined));\n\n  if (Object.keys(filteredProps).length > 0) {\n    Object.entries(filteredProps).forEach(([key, value]) => {\n      if (!handlers.includes(key)) {\n        let root = instance;\n        let target = root[key];\n\n        if (key.includes('-')) {\n          const entries = key.split('-');\n          target = entries.reduce((acc, key) => acc[key], instance); // If the target is atomic, it forces us to switch the root\n\n          if (!(target && target.set)) {\n            const [name, ...reverseEntries] = entries.reverse();\n            root = reverseEntries.reverse().reduce((acc, key) => acc[key], instance);\n            key = name;\n          }\n        } // Special treatment for objects with support for set/copy\n\n\n        if (target && target.set && (target.copy || target instanceof Layers)) {\n          // If value is an array it has got to be the set function\n          if (Array.isArray(value)) target.set(...value); // Test again target.copy(class) next ...\n          else if (target.copy && value && value.constructor && target.constructor.name === value.constructor.name) target.copy(value); // If nothing else fits, just set the single value, ignore undefined\n            // https://github.com/react-spring/react-three-fiber/issues/274\n            else if (value !== undefined) target.set(value); // Else, just overwrite the value\n        } else root[key] = value;\n\n        invalidateInstance(instance);\n      }\n    }); // Preemptively delete the instance from the containers interaction\n\n    if (accumulative && container && instance.raycast && instance.__handlers) {\n      instance.__handlers = undefined;\n\n      const index = container.__interaction.indexOf(instance);\n\n      if (index > -1) container.__interaction.splice(index, 1);\n    } // Prep interaction handlers\n\n\n    if (handlers.length) {\n      // Add interactive object to central container\n      if (container && instance.raycast) container.__interaction.push(instance); // Add handlers to the instances handler-map\n\n      instance.__handlers = handlers.reduce((acc, key) => _extends({}, acc, {\n        [key.charAt(2).toLowerCase() + key.substr(3)]: newProps[key]\n      }), {});\n    } // Call the update lifecycle when it is being updated, but only when it is part of the scene\n\n\n    if (instance.parent) updateInstance(instance);\n  }\n}\n\nfunction invalidateInstance(instance) {\n  if (instance.__container && instance.__container.__state) invalidate(instance.__container.__state);\n}\n\nfunction updateInstance(instance) {\n  if (instance.onUpdate) instance.onUpdate(instance);\n}\n\nfunction createInstance(type, _ref, container, hostContext, internalInstanceHandle) {\n  let {\n    args = []\n  } = _ref,\n      props = _objectWithoutPropertiesLoose(_ref, [\"args\"]);\n\n  let name = \"\" + type[0].toUpperCase() + type.slice(1);\n  let instance;\n\n  if (type === 'primitive') {\n    instance = props.object;\n    instance.__instance = true;\n  } else if (type === 'new') {\n    instance = new props.object(args);\n  } else {\n    const target = catalogue[name] || THREE[name];\n    instance = is.arr(args) ? new target(...args) : new target(args);\n  } // Bind to the root container in case portals are being used\n  // This is perhaps better for event management as we can keep them on a single instance\n\n\n  while (container.__container) {\n    container = container.__container;\n  } // TODO: https://github.com/facebook/react/issues/17147\n  // If it's still not there it means the portal was created on a virtual node outside of react\n\n\n  if (!roots.has(container)) {\n    const fn = node => {\n      if (!node.return) return node.stateNode && node.stateNode.containerInfo;else return fn(node.return);\n    };\n\n    container = fn(internalInstanceHandle);\n  } // Apply initial props\n\n\n  instance.__objects = [];\n  instance.__container = container; // It should NOT call onUpdate on object instanciation, because it hasn't been added to the\n  // view yet. If the callback relies on references for instance, they won't be ready yet, this is\n  // why it passes \"false\" here\n\n  applyProps(instance, props, {});\n  return instance;\n}\n\nfunction appendChild(parentInstance, child) {\n  if (child) {\n    if (child.isObject3D) parentInstance.add(child);else {\n      parentInstance.__objects.push(child);\n\n      child.parent = parentInstance; // The attach attribute implies that the object attaches itself on the parent\n\n      if (child.attach) parentInstance[child.attach] = child;else if (child.attachArray) {\n        if (!is.arr(parentInstance[child.attachArray])) parentInstance[child.attachArray] = [];\n        parentInstance[child.attachArray].push(child);\n      } else if (child.attachObject) {\n        if (!is.obj(parentInstance[child.attachObject[0]])) parentInstance[child.attachObject[0]] = {};\n        parentInstance[child.attachObject[0]][child.attachObject[1]] = child;\n      }\n    }\n    updateInstance(child);\n    invalidateInstance(child);\n  }\n}\n\nfunction insertBefore(parentInstance, child, beforeChild) {\n  if (child) {\n    if (child.isObject3D) {\n      child.parent = parentInstance;\n      child.dispatchEvent({\n        type: 'added'\n      });\n      const restSiblings = parentInstance.children.filter(sibling => sibling !== child); // TODO: the order is out of whack if data objects are present, has to be recalculated\n\n      const index = restSiblings.indexOf(beforeChild);\n      parentInstance.children = [...restSiblings.slice(0, index), child, ...restSiblings.slice(index)];\n      updateInstance(child);\n    } else appendChild(parentInstance, child); // TODO: order!!!\n\n\n    invalidateInstance(child);\n  }\n}\n\nfunction removeRecursive(array, parent, clone = false) {\n  if (array) {\n    // Three uses splice op's internally we may have to shallow-clone the array in order to safely remove items\n    const target = clone ? [...array] : array;\n    target.forEach(child => removeChild(parent, child));\n  }\n}\n\nfunction removeChild(parentInstance, child) {\n  if (child) {\n    if (child.isObject3D) {\n      parentInstance.remove(child);\n    } else {\n      child.parent = null;\n      parentInstance.__objects = parentInstance.__objects.filter(x => x !== child); // Remove attachment\n\n      if (child.attach) parentInstance[child.attach] = null;else if (child.attachArray) parentInstance[child.attachArray] = parentInstance[child.attachArray].filter(x => x !== child);else if (child.attachObject) {\n        delete parentInstance[child.attachObject[0]][child.attachObject[1]];\n      }\n    }\n\n    invalidateInstance(child); // Allow objects to bail out of recursive dispose alltogether by passing dispose={null}\n\n    if (child.dispose !== null) {\n      unstable_runWithPriority(unstable_IdlePriority, () => {\n        // Remove interactivity\n        if (child.__container) child.__container.__interaction = child.__container.__interaction.filter(x => x !== child); // Remove nested child objects\n\n        removeRecursive(child.__objects, child);\n        removeRecursive(child.children, child, true); // Dispose item\n\n        if (child.dispose) child.dispose(); // Remove references\n\n        delete child.__container;\n        delete child.__objects;\n      });\n    }\n  }\n}\n\nfunction switchInstance(instance, type, newProps, fiber) {\n  const parent = instance.parent;\n  const newInstance = createInstance(type, newProps, instance.__container, null, fiber);\n  removeChild(parent, instance);\n  appendChild(parent, newInstance) // This evil hack switches the react-internal fiber node\n  // https://github.com/facebook/react/issues/14983\n  // https://github.com/facebook/react/pull/15021\n  ;\n  [fiber, fiber.alternate].forEach(fiber => {\n    if (fiber !== null) {\n      fiber.stateNode = newInstance;\n\n      if (fiber.ref) {\n        if (is.fun(fiber.ref)) fiber.ref(newInstance);else fiber.ref.current = newInstance;\n      }\n    }\n  });\n}\n\nconst Renderer = Reconciler({\n  now: unstable_now,\n  createInstance,\n  removeChild,\n  appendChild,\n  insertBefore,\n  // @ts-ignore\n  warnsIfNotActing: true,\n  supportsMutation: true,\n  isPrimaryRenderer: false,\n  scheduleTimeout: is.fun(setTimeout) ? setTimeout : undefined,\n  cancelTimeout: is.fun(clearTimeout) ? clearTimeout : undefined,\n  // @ts-ignore\n  setTimeout: is.fun(setTimeout) ? setTimeout : undefined,\n  // @ts-ignore\n  clearTimeout: is.fun(clearTimeout) ? clearTimeout : undefined,\n  noTimeout: -1,\n  appendInitialChild: appendChild,\n  appendChildToContainer: appendChild,\n  removeChildFromContainer: removeChild,\n  insertInContainerBefore: insertBefore,\n\n  commitUpdate(instance, updatePayload, type, oldProps, newProps, fiber) {\n    if (instance.__instance && newProps.object && newProps.object !== instance) {\n      // <instance object={...} /> where the object reference has changed\n      switchInstance(instance, type, newProps, fiber);\n    } else {\n      // This is a data object, let's extract critical information about it\n      const {\n        args: argsNew = []\n      } = newProps,\n            restNew = _objectWithoutPropertiesLoose(newProps, [\"args\"]);\n\n      const {\n        args: argsOld = []\n      } = oldProps,\n            restOld = _objectWithoutPropertiesLoose(oldProps, [\"args\"]); // If it has new props or arguments, then it needs to be re-instanciated\n\n\n      const hasNewArgs = argsNew.some((value, index) => is.obj(value) ? Object.entries(value).some(([key, val]) => val !== argsOld[index][key]) : value !== argsOld[index]);\n\n      if (hasNewArgs) {\n        // Next we create a new instance and append it again\n        switchInstance(instance, type, newProps, fiber);\n      } else {\n        // Otherwise just overwrite props\n        applyProps(instance, restNew, restOld, true);\n      }\n    }\n  },\n\n  hideInstance(instance) {\n    if (instance.isObject3D) {\n      instance.visible = false;\n      invalidateInstance(instance);\n    }\n  },\n\n  unhideInstance(instance, props) {\n    if (instance.isObject3D && props.visible == null || props.visible) {\n      instance.visible = true;\n      invalidateInstance(instance);\n    }\n  },\n\n  hideTextInstance() {\n    throw new Error('Text is not allowed in the react-three-fibre tree. You may have extraneous whitespace between components.');\n  },\n\n  getPublicInstance(instance) {\n    return instance;\n  },\n\n  getRootHostContext() {\n    return emptyObject;\n  },\n\n  getChildHostContext() {\n    return emptyObject;\n  },\n\n  createTextInstance() {},\n\n  finalizeInitialChildren() {\n    return false;\n  },\n\n  prepareUpdate() {\n    return emptyObject;\n  },\n\n  shouldDeprioritizeSubtree() {\n    return false;\n  },\n\n  prepareForCommit() {},\n\n  resetAfterCommit() {},\n\n  shouldSetTextContent() {\n    return false;\n  }\n\n});\nconst LegacyRoot = 0;\nconst ConcurrentRoot = 2;\nconst hasSymbol = is.fun(Symbol) && Symbol.for;\nconst REACT_PORTAL_TYPE = hasSymbol ? Symbol.for('react.portal') : 0xeaca;\n\nfunction render(element, container, state) {\n  let root = roots.get(container);\n\n  if (!root) {\n    container.__state = state;\n    let newRoot = root = Renderer.createContainer(container, state !== undefined && state.current.concurrent ? ConcurrentRoot : LegacyRoot, false);\n    roots.set(container, newRoot);\n  }\n\n  Renderer.updateContainer(element, root, null, () => undefined);\n  return Renderer.getPublicRootInstance(root);\n}\n\nfunction unmountComponentAtNode(container) {\n  const root = roots.get(container);\n  if (root) Renderer.updateContainer(null, root, null, () => void roots.delete(container));\n}\n\nfunction createPortal(children, containerInfo, implementation, key = null) {\n  if (!containerInfo.__objects) containerInfo.__objects = [];\n  return {\n    $$typeof: REACT_PORTAL_TYPE,\n    key: key == null ? null : '' + key,\n    children,\n    containerInfo,\n    implementation\n  };\n}\n\nRenderer.injectIntoDevTools({\n  bundleType: process.env.NODE_ENV === 'production' ? 0 : 1,\n  version: version,\n  rendererPackageName: 'react-three-fiber',\n  findHostInstanceByFiber: Renderer.findHostInstance\n});\n\nfunction isOrthographicCamera(def) {\n  return def.isOrthographicCamera;\n}\n\nfunction makeId(event) {\n  return (event.eventObject || event.object).uuid + '/' + event.index;\n}\n\nconst stateContext = createContext({});\n\nconst useCanvas = props => {\n  const {\n    children,\n    gl,\n    camera,\n    orthographic,\n    raycaster,\n    size,\n    pixelRatio,\n    vr = false,\n    concurrent = false,\n    shadowMap = false,\n    sRGB = false,\n    invalidateFrameloop = false,\n    updateDefaultCamera = true,\n    noEvents = false,\n    onCreated,\n    onPointerMissed\n  } = props; // Local, reactive state\n\n  const [ready, setReady] = useState(false);\n  const [mouse] = useState(() => new Vector2());\n  const [defaultRaycaster] = useState(() => {\n    const ray = new Raycaster();\n\n    if (raycaster) {\n      const raycasterProps = _objectWithoutPropertiesLoose(raycaster, [\"filter\"]);\n\n      applyProps(ray, raycasterProps, {});\n    }\n\n    return ray;\n  });\n  const [defaultScene] = useState(() => {\n    const scene = new Scene();\n    scene.__interaction = [];\n    scene.__objects = [];\n    return scene;\n  });\n  const [defaultCam, _setDefaultCamera] = useState(() => {\n    const cam = orthographic ? new OrthographicCamera(0, 0, 0, 0, 0.1, 1000) : new PerspectiveCamera(75, 0, 0.1, 1000);\n    cam.position.z = 5;\n    if (camera) applyProps(cam, camera, {}); // Always look at [0, 0, 0]\n\n    cam.lookAt(0, 0, 0);\n    return cam;\n  });\n  const [clock] = useState(() => new Clock()); // Public state\n\n  const state = useRef({\n    ready: false,\n    active: true,\n    manual: 0,\n    vr,\n    concurrent,\n    noEvents,\n    invalidateFrameloop: false,\n    frames: 0,\n    aspect: 0,\n    subscribers: [],\n    camera: defaultCam,\n    scene: defaultScene,\n    raycaster: defaultRaycaster,\n    mouse,\n    clock,\n    gl,\n    size,\n    viewport: {\n      width: 0,\n      height: 0,\n      factor: 0\n    },\n    initialClick: [0, 0],\n    initialHits: [],\n    pointer: new TinyEmitter(),\n    captured: undefined,\n    events: undefined,\n    subscribe: (ref, priority = 0) => {\n      // If this subscription was given a priority, it takes rendering into its own hands\n      // For that reason we switch off automatic rendering and increase the manual flag\n      // As long as this flag is positive (there could be multiple render subscription)\n      // ..there can be no internal rendering at all\n      if (priority) state.current.manual++;\n      state.current.subscribers.push({\n        ref,\n        priority: priority\n      }); // Sort layers from lowest to highest, meaning, highest priority renders last (on top of the other frames)\n\n      state.current.subscribers = state.current.subscribers.sort((a, b) => a.priority - b.priority);\n      return () => {\n        // Decrease manual flag if this subscription had a priority\n        if (priority) state.current.manual--;\n        state.current.subscribers = state.current.subscribers.filter(s => s.ref !== ref);\n      };\n    },\n    setDefaultCamera: camera => _setDefaultCamera(camera),\n    invalidate: () => invalidate(state),\n    intersect: event => handlePointerMove(event || {})\n  }); // Writes locals into public state for distribution among subscribers, context, etc\n\n  useMemo(() => {\n    state.current.ready = ready;\n    state.current.size = size;\n    state.current.camera = defaultCam;\n    state.current.invalidateFrameloop = invalidateFrameloop;\n    state.current.vr = vr;\n    state.current.gl = gl;\n    state.current.concurrent = concurrent;\n    state.current.noEvents = noEvents;\n  }, [invalidateFrameloop, vr, concurrent, noEvents, ready, size, defaultCam, gl]); // Adjusts default camera\n\n  useMemo(() => {\n    state.current.aspect = size.width / size.height;\n\n    if (isOrthographicCamera(defaultCam)) {\n      state.current.viewport = {\n        width: size.width,\n        height: size.height,\n        factor: 1\n      };\n    } else {\n      const target = new Vector3(0, 0, 0);\n      const distance = defaultCam.position.distanceTo(target);\n      const fov = defaultCam.fov * Math.PI / 180; // convert vertical fov to radians\n\n      const height = 2 * Math.tan(fov / 2) * distance; // visible height\n\n      const width = height * state.current.aspect;\n      state.current.viewport = {\n        width,\n        height,\n        factor: size.width / width\n      };\n    } // #92 (https://github.com/drcmda/react-three-fiber/issues/92)\n    // Sometimes automatic default camera adjustment isn't wanted behaviour\n\n\n    if (updateDefaultCamera) {\n      if (isOrthographicCamera(defaultCam)) {\n        defaultCam.left = size.width / -2;\n        defaultCam.right = size.width / 2;\n        defaultCam.top = size.height / 2;\n        defaultCam.bottom = size.height / -2;\n      } else {\n        defaultCam.aspect = state.current.aspect;\n      }\n\n      defaultCam.updateProjectionMatrix(); // #178: https://github.com/react-spring/react-three-fiber/issues/178\n      // Update matrix world since the renderer is a frame late\n\n      defaultCam.updateMatrixWorld();\n    }\n\n    gl.setSize(size.width, size.height);\n    if (ready) invalidate(state);\n  }, [defaultCam, size, updateDefaultCamera]);\n  /** Events ------------------------------------------------------------------------------------------------ */\n\n  /** Sets up defaultRaycaster */\n\n  const prepareRay = useCallback(({\n    clientX,\n    clientY\n  }) => {\n    if (clientX !== void 0) {\n      const {\n        left,\n        right,\n        top,\n        bottom\n      } = state.current.size;\n      mouse.set((clientX - left) / (right - left) * 2 - 1, -((clientY - top) / (bottom - top)) * 2 + 1);\n      defaultRaycaster.setFromCamera(mouse, state.current.camera);\n    }\n  }, []);\n  /** Intersects interaction objects using the event input */\n\n  const intersect = useCallback((event, prepare = true, filter) => {\n    // Skip event handling when noEvents is set\n    if (state.current.noEvents) return [];\n    if (prepare) prepareRay(event);\n    const seen = new Set();\n    const hits = []; // Allow callers to eliminate event objects\n\n    const eventsObjects = filter ? filter(state.current.scene.__interaction) : state.current.scene.__interaction; // Intersect known handler objects and filter against duplicates\n\n    let intersects = defaultRaycaster.intersectObjects(eventsObjects, true).filter(item => {\n      const id = makeId(item);\n      if (seen.has(id)) return false;\n      seen.add(id);\n      return true;\n    }); // #16031: (https://github.com/mrdoob/three.js/issues/16031)\n    // Allow custom userland intersect sort order\n\n    if (raycaster && raycaster.filter && sharedState.current) intersects = raycaster.filter(intersects, sharedState.current);\n\n    for (let intersect of intersects) {\n      let eventObject = intersect.object; // Bubble event up\n\n      while (eventObject) {\n        const handlers = eventObject.__handlers;\n        if (handlers) hits.push(_extends({}, intersect, {\n          eventObject\n        }));\n        eventObject = eventObject.parent;\n      }\n    }\n\n    return hits;\n  }, []);\n  /**  Calculates click deltas */\n\n  const calculateDistance = useCallback(event => {\n    let dx = event.clientX - state.current.initialClick[0];\n    let dy = event.clientY - state.current.initialClick[1];\n    return Math.round(Math.sqrt(dx * dx + dy * dy));\n  }, []);\n  const hovered = useMemo(() => new Map(), []);\n  /**  Handles intersections by forwarding them to handlers */\n\n  const temp = new Vector3();\n  const handleIntersects = useCallback((event, fn, filter) => {\n    prepareRay(event); // Get fresh intersects\n\n    let hits = intersect(event, false, filter); // If the interaction is captured take that into account, the captured event has to be part of the intersects\n\n    if (state.current.captured && event.type !== 'click' && event.type !== 'wheel') {\n      state.current.captured.forEach(captured => {\n        if (!hits.find(hit => hit.eventObject === captured.eventObject)) hits.push(captured);\n      });\n    } // If anything has been found, forward it to the event listeners\n\n\n    if (hits.length) {\n      const unprojectedPoint = temp.set(mouse.x, mouse.y, 0).unproject(state.current.camera);\n      const delta = event.type === 'click' ? calculateDistance(event) : 0;\n\n      const releasePointerCapture = id => event.target.releasePointerCapture(id);\n\n      const localState = {\n        stopped: false,\n        captured: false\n      };\n\n      for (let hit of hits) {\n        const setPointerCapture = id => {\n          // If the hit is going to be captured flag that we're in captured state\n          if (!localState.captured) {\n            localState.captured = true; // The captured hit array is reset to collect hits\n\n            state.current.captured = [];\n          } // Push hits to the array\n\n\n          if (state.current.captured) state.current.captured.push(hit) // Call the original event now\n          ;\n          event.target.setPointerCapture(id);\n        };\n\n        let raycastEvent = _extends({}, event, {}, hit, {\n          stopped: localState.stopped,\n          delta,\n          unprojectedPoint,\n          ray: defaultRaycaster.ray,\n          camera: state.current.camera,\n          // Hijack stopPropagation, which just sets a flag\n          stopPropagation: () => raycastEvent.stopped = localState.stopped = true,\n          // Pointer-capture needs the hit, on which the user may call stopPropagation()\n          // This makes it harder to use the actual event, because then we loose the connection\n          // to the actual hit, which would mean it's picking up all intersects ...\n          target: _extends({}, event.target, {\n            setPointerCapture,\n            releasePointerCapture\n          }),\n          currentTarget: _extends({}, event.currentTarget, {\n            setPointerCapture,\n            releasePointerCapture\n          }),\n          sourceEvent: event\n        });\n\n        fn(raycastEvent);\n\n        if (localState.stopped === true) {\n          // Propagation is stopped, remove all other hover records\n          // An event handler is only allowed to flush other handlers if it is hovered itself\n          if (hovered.size && Array.from(hovered.values()).find(i => i.object === hit.object)) {\n            handlePointerCancel(raycastEvent, [hit]);\n          }\n\n          break;\n        }\n      }\n    }\n\n    return hits;\n  }, []);\n  const handlePointerMove = useCallback(event => {\n    state.current.pointer.emit('pointerMove', event);\n    const hits = handleIntersects(event, data => {\n      const eventObject = data.eventObject;\n      const handlers = eventObject.__handlers; // Check presence of handlers\n\n      if (!handlers) return; // Call mouse move\n\n      if (handlers.pointerMove) handlers.pointerMove(data); // Check if mouse enter or out is present\n\n      if (handlers.pointerOver || handlers.pointerEnter || handlers.pointerOut || handlers.pointerLeave) {\n        const id = makeId(data);\n        const hoveredItem = hovered.get(id);\n\n        if (!hoveredItem) {\n          // If the object wasn't previously hovered, book it and call its handler\n          hovered.set(id, data);\n          if (handlers.pointerOver) handlers.pointerOver(_extends({}, data, {\n            type: 'pointerover'\n          }));\n          if (handlers.pointerEnter) handlers.pointerEnter(_extends({}, data, {\n            type: 'pointerEnter'\n          }));\n        } else if (hoveredItem.stopped) {\n          // If the object was previously hovered and stopped, we shouldn't allow other items to proceed\n          data.stopPropagation();\n        }\n      }\n    }, // This is onPointerMove, we're only interested in events that exhibit this particular event\n    objects => objects.filter(obj => ['Move', 'Over', 'Enter', 'Out', 'Leave'].some(name => obj.__handlers['pointer' + name]))); // Take care of unhover\n\n    handlePointerCancel(event, hits);\n    return hits;\n  }, []);\n  const handlePointerCancel = useCallback((event, hits) => {\n    state.current.pointer.emit('pointerCancel', event);\n    if (!hits) hits = handleIntersects(event, () => null);\n    Array.from(hovered.values()).forEach(data => {\n      // When no objects were hit or the the hovered object wasn't found underneath the cursor\n      // we call onPointerOut and delete the object from the hovered-elements map\n      if (hits && (!hits.length || !hits.find(i => i.eventObject === data.eventObject))) {\n        const eventObject = data.eventObject;\n        const handlers = eventObject.__handlers;\n\n        if (handlers) {\n          if (handlers.pointerOut) handlers.pointerOut(_extends({}, data, {\n            type: 'pointerout'\n          }));\n          if (handlers.pointerLeave) handlers.pointerLeave(_extends({}, data, {\n            type: 'pointerleave'\n          }));\n        }\n\n        hovered.delete(makeId(data));\n      }\n    });\n  }, []);\n  const handlePointer = useCallback(name => event => {\n    state.current.pointer.emit(name, event); // Collect hits\n\n    const hits = handleIntersects(event, data => {\n      const eventObject = data.eventObject;\n      const handlers = eventObject.__handlers;\n\n      if (handlers && handlers[name]) {\n        // Forward all events back to their respective handlers with the exception of click,\n        // which must must the initial target\n        if (name !== 'click' || state.current.initialHits.includes(eventObject)) handlers[name](data);\n      }\n    }); // If a click yields no results, pass it back to the user as a miss\n\n    if (name === 'pointerDown') {\n      state.current.initialClick = [event.clientX, event.clientY];\n      state.current.initialHits = hits.map(hit => hit.eventObject);\n    }\n\n    if (name === 'click' && !hits.length && onPointerMissed) {\n      if (calculateDistance(event) <= 2) onPointerMissed();\n    }\n  }, [onPointerMissed]);\n  useMemo(() => {\n    state.current.events = {\n      onClick: handlePointer('click'),\n      onWheel: handlePointer('wheel'),\n      onPointerDown: handlePointer('pointerDown'),\n      onPointerUp: handlePointer('pointerUp'),\n      onPointerLeave: e => handlePointerCancel(e, []),\n      onPointerMove: handlePointerMove,\n      // onGotPointerCapture is not needed any longer because the behaviour is hacked into\n      // the event itself (see handleIntersects). But in order for non-web targets to simulate\n      // it we keep the legacy event, which simply flags all current intersects as captured\n      onGotPointerCaptureLegacy: e => state.current.captured = intersect(e, false),\n      onLostPointerCapture: e => (state.current.captured = undefined, handlePointerCancel(e))\n    };\n  }, [onPointerMissed]);\n  /** Events ------------------------------------------------------------------------------------------------- */\n  // Only trigger the context provider when necessary\n\n  const sharedState = useRef();\n  useMemo(() => {\n    const _state$current = state.current,\n          props = _objectWithoutPropertiesLoose(_state$current, [\"ready\", \"manual\", \"vr\", \"noEvents\", \"invalidateFrameloop\", \"frames\", \"subscribers\", \"captured\", \"initialClick\", \"initialHits\"]);\n\n    sharedState.current = props;\n  }, [size, defaultCam]); // Update pixel ratio\n\n  useLayoutEffect(() => void (pixelRatio && gl.setPixelRatio(pixelRatio)), [pixelRatio]); // Update shadow map\n\n  useLayoutEffect(() => {\n    if (shadowMap) {\n      gl.shadowMap.enabled = true;\n      if (typeof shadowMap === 'object') Object.assign(gl, shadowMap);else gl.shadowMap.type = PCFSoftShadowMap;\n    }\n\n    if (sRGB) {\n      gl.toneMapping = ACESFilmicToneMapping;\n      gl.outputEncoding = sRGBEncoding;\n    }\n  }, [shadowMap, sRGB]); // This component is a bridge into the three render context, when it gets rendered\n  // we know we are ready to compile shaders, call subscribers, etc\n\n  const Canvas = useCallback(function Canvas(props) {\n    const activate = () => setReady(true); // eslint-disable-next-line react-hooks/rules-of-hooks\n\n\n    useEffect(() => {\n      const result = onCreated && onCreated(state.current);\n      return void (result && result.then ? result.then(activate) : activate());\n    }, []);\n    return props.children;\n  }, []); // Render v-dom into scene\n\n  useLayoutEffect(() => {\n    render( /*#__PURE__*/createElement(Canvas, null, /*#__PURE__*/createElement(stateContext.Provider, {\n      value: sharedState.current\n    }, typeof children === 'function' ? children(state.current) : children)), defaultScene, state);\n  }, [ready, children, sharedState.current]);\n  useLayoutEffect(() => {\n    if (ready) {\n      // Start render-loop, either via RAF or setAnimationLoop for VR\n      if (!state.current.vr) {\n        invalidate(state);\n      } else if ((gl.xr || gl.vr) && gl.setAnimationLoop) {\n        (gl.xr || gl.vr).enabled = true;\n        gl.setAnimationLoop(t => renderGl(state, t, 0, true));\n      } else console.warn('the gl instance does not support VR!');\n    }\n  }, [ready, invalidateFrameloop]); // Dispose renderer on unmount\n\n  useEffect(() => () => {\n    if (state.current.gl) {\n      if (state.current.gl.forceContextLoss) state.current.gl.forceContextLoss();\n      if (state.current.gl.dispose) state.current.gl.dispose();\n      state.current.gl = undefined;\n      unmountComponentAtNode(state.current.scene);\n      state.current.active = false;\n    }\n  }, []);\n  return state.current.events;\n};\n\nfunction useContext(context) {\n  let result = useContext$1(context);\n\n  if (!result) {\n    console.warn('hooks can only be used within the canvas! https://github.com/react-spring/react-three-fiber#hooks');\n  }\n\n  return result;\n}\n\nfunction useFrame(callback, renderPriority = 0) {\n  const {\n    subscribe\n  } = useContext(stateContext); // Update ref\n\n  const ref = useRef(callback);\n  useLayoutEffect(() => void (ref.current = callback), [callback]); // Subscribe/unsub\n\n  useEffect(() => {\n    const unsubscribe = subscribe(ref, renderPriority);\n    return () => unsubscribe();\n  }, [renderPriority]);\n  return null;\n}\n\nfunction useThree() {\n  return useContext(stateContext);\n}\n\nfunction useUpdate(callback, dependents, optionalRef) {\n  const {\n    invalidate\n  } = useContext(stateContext);\n  const localRef = useRef();\n  const ref = optionalRef ? optionalRef : localRef;\n  useLayoutEffect(() => {\n    if (ref.current) {\n      callback(ref.current);\n      invalidate();\n    }\n  }, dependents);\n  return ref;\n}\n\nfunction useResource(optionalRef) {\n  const [_, forceUpdate] = useState(false);\n  const localRef = useRef(undefined);\n  const ref = optionalRef ? optionalRef : localRef;\n  useLayoutEffect(() => void forceUpdate(i => !i), [ref.current]);\n  return [ref, ref.current];\n}\n\nconst blackList = ['id', 'uuid', 'type', 'children', 'parent', 'matrix', 'matrixWorld', 'matrixWorldNeedsUpdate', 'modelViewMatrix', 'normalMatrix'];\n\nfunction prune(props) {\n  const reducedProps = _extends({}, props); // Remove black listed props\n\n\n  blackList.forEach(name => delete reducedProps[name]); // Remove functions\n\n  Object.keys(reducedProps).forEach(name => typeof reducedProps[name] === 'function' && delete reducedProps[name]); // Prune materials and geometries\n\n  if (reducedProps.material) reducedProps.material = prune(reducedProps.material);\n  if (reducedProps.geometry) reducedProps.geometry = prune(reducedProps.geometry); // Return cleansed object\n\n  return reducedProps;\n}\n\nfunction useLoader(Proto, url, extensions) {\n  const loader = useMemo(() => {\n    // Construct new loader\n    const temp = new Proto(); // Run loader extensions\n\n    if (extensions) extensions(temp);\n    return temp;\n  }, [Proto]); // Use suspense to load async assets\n\n  const results = usePromise((Proto, url) => {\n    const urlArray = Array.isArray(url) ? url : [url];\n    return Promise.all(urlArray.map(url => new Promise(res => loader.load(url, data => {\n      if (data.scene) {\n        // This has to be deprecated at some point!\n        data.__$ = []; // Nodes and materials are better\n\n        data.nodes = {};\n        data.materials = {};\n        data.scene.traverse(obj => {\n          data.__$.push(prune(obj));\n\n          if (obj.name) data.nodes = _extends({}, data.nodes, {\n            [obj.name]: obj\n          });\n          if (obj.material && !data.materials[obj.material.name]) data.materials[obj.material.name] = obj.material;\n        });\n      }\n\n      res(data);\n    }))));\n  }, [Proto, url]); // Return the object/s\n\n  return Array.isArray(url) ? results : results[0];\n}\n\nfunction useCamera(camera, props) {\n  const {\n    mouse\n  } = useThree();\n  const [raycast] = useState(() => {\n    let raycaster = new Raycaster();\n    if (props) applyProps(raycaster, props, {});\n    return function (_, intersects) {\n      raycaster.setFromCamera(mouse, camera);\n      const rc = this.constructor.prototype.raycast.bind(this);\n      if (rc) rc(raycaster, intersects);\n    };\n  });\n  return raycast;\n}\n\nconst vector = new Vector3();\n\nfunction calculatePosition(el, camera, size) {\n  vector.setFromMatrixPosition(el.matrixWorld);\n  vector.project(camera);\n  const widthHalf = size.width / 2;\n  const heightHalf = size.height / 2;\n  return [vector.x * widthHalf + widthHalf, -(vector.y * heightHalf) + heightHalf];\n}\n\nconst Dom = React__default.forwardRef((_ref, ref) => {\n  let {\n    children,\n    eps = 0.001,\n    style,\n    className,\n    prepend,\n    center\n  } = _ref,\n      props = _objectWithoutPropertiesLoose(_ref, [\"children\", \"eps\", \"style\", \"className\", \"prepend\", \"center\"]);\n\n  const {\n    gl,\n    scene,\n    camera,\n    size\n  } = useThree();\n  const [el] = useState(() => document.createElement('div'));\n  const group = useRef(null);\n  const old = useRef([0, 0]);\n  useEffect(() => {\n    if (group.current) {\n      scene.updateMatrixWorld();\n      const vec = calculatePosition(group.current, camera, size);\n      el.style.cssText = \"position:absolute;top:0;left:0;transform:translate3d(\" + vec[0] + \"px,\" + vec[1] + \"px,0);\";\n\n      if (gl.domElement.parentNode) {\n        if (prepend) gl.domElement.parentNode.prepend(el);else gl.domElement.parentNode.appendChild(el);\n      }\n\n      return () => {\n        if (gl.domElement.parentNode) gl.domElement.parentNode.removeChild(el);\n        ReactDOM.unmountComponentAtNode(el);\n      };\n    } // eslint-disable-next-line react-hooks/exhaustive-deps\n\n  }, []);\n  useEffect(() => void ReactDOM.render( /*#__PURE__*/React__default.createElement(\"div\", {\n    style: _extends({\n      transform: center ? 'translate3d(-50%,-50%,0)' : 'none'\n    }, style),\n    className: className,\n    ref: ref\n  }, children), el));\n  useFrame(() => {\n    if (group.current) {\n      const vec = calculatePosition(group.current, camera, size);\n\n      if (Math.abs(old.current[0] - vec[0]) > eps || Math.abs(old.current[1] - vec[1]) > eps) {\n        el.style.transform = \"translate3d(\" + vec[0] + \"px,\" + vec[1] + \"px,0)\";\n      }\n\n      old.current = vec;\n    }\n  });\n  return (/*#__PURE__*/React__default.createElement(\"group\", _extends({}, props, {\n      ref: group\n    }))\n  );\n});\nconst defaultStyles = {\n  position: 'relative',\n  width: '100%',\n  height: '100%',\n  overflow: 'hidden'\n};\n\nfunction Content(_ref) {\n  let {\n    children,\n    setEvents,\n    container,\n    renderer,\n    effects\n  } = _ref,\n      props = _objectWithoutPropertiesLoose(_ref, [\"children\", \"setEvents\", \"container\", \"renderer\", \"effects\"]); // Create renderer\n\n\n  const [gl] = useState(renderer);\n  if (!gl) console.warn('No renderer created!'); // Mount and unmount managemenbt\n\n  useEffect(() => effects && effects(gl, container), []); // Init canvas, fetch events, hand them back to the wrapping div\n\n  const events = useCanvas(_extends({}, props, {\n    children,\n    gl: gl\n  }));\n  useEffect(() => void setEvents(events), [events]);\n  return null;\n}\n\nconst ResizeContainer = React__default.memo(function ResizeContainer(props) {\n  const {\n    preRender,\n    resize,\n    style\n  } = props,\n        restSpread = _objectWithoutPropertiesLoose(props, [\"renderer\", \"effects\", \"children\", \"vr\", \"gl2\", \"concurrent\", \"shadowMap\", \"sRGB\", \"orthographic\", \"invalidateFrameloop\", \"updateDefaultCamera\", \"noEvents\", \"gl\", \"camera\", \"raycaster\", \"pixelRatio\", \"onCreated\", \"onPointerMissed\", \"preRender\", \"resize\", \"style\"]);\n\n  const containerRef = useRef(); // onGotPointerCaptureLegacy is a fake event used by non-web targets to simulate poinzter capture\n\n  const [_ref2, setEvents] = useState({});\n\n  const events = _objectWithoutPropertiesLoose(_ref2, [\"onGotPointerCaptureLegacy\"]);\n\n  const [bind, size] = useMeasure(resize || {\n    scroll: true,\n    debounce: {\n      scroll: 50,\n      resize: 0\n    },\n    polyfill: typeof window === 'undefined' || !window.ResizeObserver ? ResizeObserver : undefined\n  }); // Flag view ready once it's been measured out\n\n  const readyFlag = useRef(false);\n  const ready = useMemo(() => readyFlag.current = readyFlag.current || !!size.width && !!size.height, [size]);\n  const state = useMemo(() => ({\n    size,\n    setEvents,\n    container: containerRef.current\n  }), [size]); // Allow Gatsby, Next and other server side apps to run. Will output styles to reduce flickering.\n\n  if (typeof window === 'undefined') return (/*#__PURE__*/React__default.createElement(\"div\", _extends({\n      style: _extends({}, defaultStyles, {}, style)\n    }, restSpread), preRender)\n  ); // Render the canvas into the dom\n\n  return (/*#__PURE__*/React__default.createElement(\"div\", _extends({\n      ref: mergeRefs([bind, containerRef]),\n      style: _extends({}, defaultStyles, {}, style)\n    }, events, restSpread), preRender, ready && /*#__PURE__*/React__default.createElement(Content, _extends({}, props, state)))\n  );\n});\nconst Canvas = React__default.memo(function Canvas(_ref) {\n  let {\n    children\n  } = _ref,\n      props = _objectWithoutPropertiesLoose(_ref, [\"children\"]);\n\n  const canvasRef = useRef();\n  return (/*#__PURE__*/React__default.createElement(ResizeContainer, _extends({}, props, {\n      renderer: () => {\n        if (canvasRef.current) {\n          const params = _extends({\n            antialias: true,\n            alpha: true\n          }, props.gl);\n\n          const temp = new WebGLRenderer(_extends({\n            canvas: canvasRef.current,\n            context: props.gl2 ? canvasRef.current.getContext('webgl2', params) : undefined\n          }, params));\n          return temp;\n        }\n      },\n      preRender: /*#__PURE__*/React__default.createElement(\"canvas\", {\n        ref: canvasRef,\n        style: {\n          display: 'block'\n        }\n      })\n    }), children)\n  );\n});\nexport { Canvas, Dom, Renderer, addEffect, addTail, applyProps, createPortal, extend, invalidate, isOrthographicCamera, render, renderGl, stateContext, unmountComponentAtNode, useCamera, useCanvas, useFrame, useLoader, useResource, useThree, useUpdate };","map":{"version":3,"sources":["/home/pablo/go/src/gitlab.com/Pablolgn/usal-cloudsubmitter/frontend/node_modules/react-three-fiber/web.js"],"names":["_extends","_objectWithoutPropertiesLoose","THREE","Layers","Vector2","Raycaster","Scene","OrthographicCamera","PerspectiveCamera","Clock","Vector3","PCFSoftShadowMap","ACESFilmicToneMapping","sRGBEncoding","WebGLRenderer","Reconciler","unstable_now","unstable_runWithPriority","unstable_IdlePriority","React__default","createContext","useState","useRef","useMemo","useCallback","useLayoutEffect","useEffect","createElement","useContext","useContext$1","TinyEmitter","usePromise","ReactDOM","useMeasure","ResizeObserver","mergeRefs","version","_toPropertyKey","arg","key","_toPrimitive","String","input","hint","prim","Symbol","toPrimitive","undefined","res","call","TypeError","Number","roots","Map","emptyObject","is","obj","a","Object","arr","fun","str","num","und","Array","isArray","equ","b","i","createSubs","callback","subs","index","length","push","splice","globalEffects","globalTailEffects","addEffect","addTail","renderGl","state","timestamp","repeat","runGlobalEffects","forEach","effect","delta","current","clock","getDelta","subscribers","sub","ref","frames","Math","max","invalidateFrameloop","manual","gl","render","scene","camera","running","renderLoop","root","containerInfo","__state","active","ready","requestAnimationFrame","invalidate","vr","catalogue","extend","objects","applyProps","instance","newProps","oldProps","accumulative","container","__container","sameProps","keys","filter","handlers","startsWith","includes","leftOvers","filteredProps","reduce","acc","prop","rest","map","entries","value","target","split","set","name","reverseEntries","reverse","copy","constructor","invalidateInstance","raycast","__handlers","__interaction","indexOf","charAt","toLowerCase","substr","parent","updateInstance","onUpdate","createInstance","type","_ref","hostContext","internalInstanceHandle","args","props","toUpperCase","slice","object","__instance","has","fn","node","return","stateNode","__objects","appendChild","parentInstance","child","isObject3D","add","attach","attachArray","attachObject","insertBefore","beforeChild","dispatchEvent","restSiblings","children","sibling","removeRecursive","array","clone","removeChild","remove","x","dispose","switchInstance","fiber","newInstance","alternate","Renderer","now","warnsIfNotActing","supportsMutation","isPrimaryRenderer","scheduleTimeout","setTimeout","cancelTimeout","clearTimeout","noTimeout","appendInitialChild","appendChildToContainer","removeChildFromContainer","insertInContainerBefore","commitUpdate","updatePayload","argsNew","restNew","argsOld","restOld","hasNewArgs","some","val","hideInstance","visible","unhideInstance","hideTextInstance","Error","getPublicInstance","getRootHostContext","getChildHostContext","createTextInstance","finalizeInitialChildren","prepareUpdate","shouldDeprioritizeSubtree","prepareForCommit","resetAfterCommit","shouldSetTextContent","LegacyRoot","ConcurrentRoot","hasSymbol","for","REACT_PORTAL_TYPE","element","get","newRoot","createContainer","concurrent","updateContainer","getPublicRootInstance","unmountComponentAtNode","delete","createPortal","implementation","$$typeof","injectIntoDevTools","bundleType","process","env","NODE_ENV","rendererPackageName","findHostInstanceByFiber","findHostInstance","isOrthographicCamera","def","makeId","event","eventObject","uuid","stateContext","useCanvas","orthographic","raycaster","size","pixelRatio","shadowMap","sRGB","updateDefaultCamera","noEvents","onCreated","onPointerMissed","setReady","mouse","defaultRaycaster","ray","raycasterProps","defaultScene","defaultCam","_setDefaultCamera","cam","position","z","lookAt","aspect","viewport","width","height","factor","initialClick","initialHits","pointer","captured","events","subscribe","priority","sort","s","setDefaultCamera","intersect","handlePointerMove","distance","distanceTo","fov","PI","tan","left","right","top","bottom","updateProjectionMatrix","updateMatrixWorld","setSize","prepareRay","clientX","clientY","setFromCamera","prepare","seen","Set","hits","eventsObjects","intersects","intersectObjects","item","id","sharedState","calculateDistance","dx","dy","round","sqrt","hovered","temp","handleIntersects","find","hit","unprojectedPoint","y","unproject","releasePointerCapture","localState","stopped","setPointerCapture","raycastEvent","stopPropagation","currentTarget","sourceEvent","from","values","handlePointerCancel","emit","data","pointerMove","pointerOver","pointerEnter","pointerOut","pointerLeave","hoveredItem","handlePointer","onClick","onWheel","onPointerDown","onPointerUp","onPointerLeave","e","onPointerMove","onGotPointerCaptureLegacy","onLostPointerCapture","_state$current","setPixelRatio","enabled","assign","toneMapping","outputEncoding","Canvas","activate","result","then","Provider","xr","setAnimationLoop","t","console","warn","forceContextLoss","context","useFrame","renderPriority","unsubscribe","useThree","useUpdate","dependents","optionalRef","localRef","useResource","_","forceUpdate","blackList","prune","reducedProps","material","geometry","useLoader","Proto","url","extensions","loader","results","urlArray","Promise","all","load","__$","nodes","materials","traverse","useCamera","rc","prototype","bind","vector","calculatePosition","el","setFromMatrixPosition","matrixWorld","project","widthHalf","heightHalf","Dom","forwardRef","eps","style","className","prepend","center","document","group","old","vec","cssText","domElement","parentNode","transform","abs","defaultStyles","overflow","Content","setEvents","renderer","effects","ResizeContainer","memo","preRender","resize","restSpread","containerRef","_ref2","scroll","debounce","polyfill","window","readyFlag","canvasRef","params","antialias","alpha","canvas","gl2","getContext","display"],"mappings":"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","sourcesContent":["import _extends from '@babel/runtime/helpers/esm/extends';\nimport _objectWithoutPropertiesLoose from '@babel/runtime/helpers/esm/objectWithoutPropertiesLoose';\nimport * as THREE from 'three';\nimport { Layers, Vector2, Raycaster, Scene, OrthographicCamera, PerspectiveCamera, Clock, Vector3, PCFSoftShadowMap, ACESFilmicToneMapping, sRGBEncoding, WebGLRenderer } from 'three';\nimport Reconciler from 'react-reconciler';\nimport { unstable_now, unstable_runWithPriority, unstable_IdlePriority } from 'scheduler';\nimport React__default, { createContext, useState, useRef, useMemo, useCallback, useLayoutEffect, useEffect, createElement, useContext as useContext$1 } from 'react';\nimport { TinyEmitter } from 'tiny-emitter';\nimport usePromise from 'react-promise-suspense';\nimport ReactDOM from 'react-dom';\nimport useMeasure from 'react-use-measure';\nimport { ResizeObserver } from '@juggle/resize-observer';\nimport mergeRefs from 'react-merge-refs';\n\nvar version = \"4.0.26\";\n\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\n\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\nconst roots = new Map();\nconst emptyObject = {};\nconst is = {\n  obj: a => a === Object(a) && !is.arr(a),\n  fun: a => typeof a === 'function',\n  str: a => typeof a === 'string',\n  num: a => typeof a === 'number',\n  und: a => a === void 0,\n  arr: a => Array.isArray(a),\n\n  equ(a, b) {\n    // Wrong type or one of the two undefined, doesn't match\n    if (typeof a !== typeof b || !!a !== !!b) return false; // Atomic, just compare a against b\n\n    if (is.str(a) || is.num(a) || is.obj(a)) return a === b; // Array, shallow compare first to see if it's a match\n\n    if (is.arr(a) && a == b) return true; // Last resort, go through keys\n\n    let i;\n\n    for (i in a) if (!(i in b)) return false;\n\n    for (i in b) if (a[i] !== b[i]) return false;\n\n    return is.und(i) ? a === b : true;\n  }\n\n};\n\nfunction createSubs(callback, subs) {\n  const index = subs.length;\n  subs.push(callback);\n  return () => void subs.splice(index, 1);\n}\n\nlet globalEffects = [];\nlet globalTailEffects = [];\nconst addEffect = callback => createSubs(callback, globalEffects);\nconst addTail = callback => createSubs(callback, globalTailEffects);\nfunction renderGl(state, timestamp, repeat = 0, runGlobalEffects = false) {\n  // Run global effects\n  if (runGlobalEffects) globalEffects.forEach(effect => effect(timestamp) && repeat++); // Run local effects\n\n  const delta = state.current.clock.getDelta();\n  state.current.subscribers.forEach(sub => sub.ref.current(state.current, delta)); // Decrease frame count\n\n  state.current.frames = Math.max(0, state.current.frames - 1);\n  repeat += !state.current.invalidateFrameloop ? 1 : state.current.frames; // Render content\n\n  if (!state.current.manual) state.current.gl.render(state.current.scene, state.current.camera);\n  return repeat;\n}\nlet running = false;\n\nfunction renderLoop(timestamp) {\n  running = true;\n  let repeat = 0; // Run global effects\n\n  globalEffects.forEach(effect => effect(timestamp) && repeat++);\n  roots.forEach(root => {\n    const state = root.containerInfo.__state; // If the frameloop is invalidated, do not run another frame\n\n    if (state.current.active && state.current.ready && (!state.current.invalidateFrameloop || state.current.frames > 0)) repeat = renderGl(state, timestamp, repeat);\n  });\n  if (repeat !== 0) return requestAnimationFrame(renderLoop);else {\n    // Tail call effects, they are called when rendering stops\n    globalTailEffects.forEach(effect => effect(timestamp));\n  } // Flag end of operation\n\n  running = false;\n}\n\nfunction invalidate(state = true, frames = 2) {\n  if (state === true) roots.forEach(root => root.containerInfo.__state.current.frames = frames);else if (state && state.current) {\n    if (state.current.vr) return;\n    state.current.frames = frames;\n  }\n\n  if (!running) {\n    running = true;\n    requestAnimationFrame(renderLoop);\n  }\n}\nlet catalogue = {};\nconst extend = objects => void (catalogue = _extends({}, catalogue, {}, objects));\nfunction applyProps(instance, newProps, oldProps = {}, accumulative = false) {\n  // Filter equals, events and reserved props\n  const container = instance.__container;\n  const sameProps = Object.keys(newProps).filter(key => is.equ(newProps[key], oldProps[key]));\n  const handlers = Object.keys(newProps).filter(key => {\n    // Event-handlers ...\n    //   are functions, that\n    //   start with \"on\", and\n    //   contain the name \"pointer\", or \"wheel\", or \"click\"\n    if (is.fun(newProps[key]) && key.startsWith('on')) {\n      return key.includes('Pointer') || key.includes('Click') || key.includes('Wheel');\n    }\n  });\n  const leftOvers = accumulative ? Object.keys(oldProps).filter(key => newProps[key] === void 0) : [];\n  const filteredProps = [...sameProps, 'children', 'key', 'ref'].reduce((acc, prop) => {\n    let rest = _objectWithoutPropertiesLoose(acc, [prop].map(_toPropertyKey));\n\n    return rest;\n  }, newProps); // Add left-overs as undefined props so they can be removed\n\n  leftOvers.forEach(key => key !== 'children' && (filteredProps[key] = undefined));\n\n  if (Object.keys(filteredProps).length > 0) {\n    Object.entries(filteredProps).forEach(([key, value]) => {\n      if (!handlers.includes(key)) {\n        let root = instance;\n        let target = root[key];\n\n        if (key.includes('-')) {\n          const entries = key.split('-');\n          target = entries.reduce((acc, key) => acc[key], instance); // If the target is atomic, it forces us to switch the root\n\n          if (!(target && target.set)) {\n            const [name, ...reverseEntries] = entries.reverse();\n            root = reverseEntries.reverse().reduce((acc, key) => acc[key], instance);\n            key = name;\n          }\n        } // Special treatment for objects with support for set/copy\n\n\n        if (target && target.set && (target.copy || target instanceof Layers)) {\n          // If value is an array it has got to be the set function\n          if (Array.isArray(value)) target.set(...value); // Test again target.copy(class) next ...\n          else if (target.copy && value && value.constructor && target.constructor.name === value.constructor.name) target.copy(value); // If nothing else fits, just set the single value, ignore undefined\n            // https://github.com/react-spring/react-three-fiber/issues/274\n            else if (value !== undefined) target.set(value); // Else, just overwrite the value\n        } else root[key] = value;\n\n        invalidateInstance(instance);\n      }\n    }); // Preemptively delete the instance from the containers interaction\n\n    if (accumulative && container && instance.raycast && instance.__handlers) {\n      instance.__handlers = undefined;\n\n      const index = container.__interaction.indexOf(instance);\n\n      if (index > -1) container.__interaction.splice(index, 1);\n    } // Prep interaction handlers\n\n\n    if (handlers.length) {\n      // Add interactive object to central container\n      if (container && instance.raycast) container.__interaction.push(instance); // Add handlers to the instances handler-map\n\n      instance.__handlers = handlers.reduce((acc, key) => _extends({}, acc, {\n        [key.charAt(2).toLowerCase() + key.substr(3)]: newProps[key]\n      }), {});\n    } // Call the update lifecycle when it is being updated, but only when it is part of the scene\n\n\n    if (instance.parent) updateInstance(instance);\n  }\n}\n\nfunction invalidateInstance(instance) {\n  if (instance.__container && instance.__container.__state) invalidate(instance.__container.__state);\n}\n\nfunction updateInstance(instance) {\n  if (instance.onUpdate) instance.onUpdate(instance);\n}\n\nfunction createInstance(type, _ref, container, hostContext, internalInstanceHandle) {\n  let {\n    args = []\n  } = _ref,\n      props = _objectWithoutPropertiesLoose(_ref, [\"args\"]);\n\n  let name = \"\" + type[0].toUpperCase() + type.slice(1);\n  let instance;\n\n  if (type === 'primitive') {\n    instance = props.object;\n    instance.__instance = true;\n  } else if (type === 'new') {\n    instance = new props.object(args);\n  } else {\n    const target = catalogue[name] || THREE[name];\n    instance = is.arr(args) ? new target(...args) : new target(args);\n  } // Bind to the root container in case portals are being used\n  // This is perhaps better for event management as we can keep them on a single instance\n\n\n  while (container.__container) {\n    container = container.__container;\n  } // TODO: https://github.com/facebook/react/issues/17147\n  // If it's still not there it means the portal was created on a virtual node outside of react\n\n\n  if (!roots.has(container)) {\n    const fn = node => {\n      if (!node.return) return node.stateNode && node.stateNode.containerInfo;else return fn(node.return);\n    };\n\n    container = fn(internalInstanceHandle);\n  } // Apply initial props\n\n\n  instance.__objects = [];\n  instance.__container = container; // It should NOT call onUpdate on object instanciation, because it hasn't been added to the\n  // view yet. If the callback relies on references for instance, they won't be ready yet, this is\n  // why it passes \"false\" here\n\n  applyProps(instance, props, {});\n  return instance;\n}\n\nfunction appendChild(parentInstance, child) {\n  if (child) {\n    if (child.isObject3D) parentInstance.add(child);else {\n      parentInstance.__objects.push(child);\n\n      child.parent = parentInstance; // The attach attribute implies that the object attaches itself on the parent\n\n      if (child.attach) parentInstance[child.attach] = child;else if (child.attachArray) {\n        if (!is.arr(parentInstance[child.attachArray])) parentInstance[child.attachArray] = [];\n        parentInstance[child.attachArray].push(child);\n      } else if (child.attachObject) {\n        if (!is.obj(parentInstance[child.attachObject[0]])) parentInstance[child.attachObject[0]] = {};\n        parentInstance[child.attachObject[0]][child.attachObject[1]] = child;\n      }\n    }\n    updateInstance(child);\n    invalidateInstance(child);\n  }\n}\n\nfunction insertBefore(parentInstance, child, beforeChild) {\n  if (child) {\n    if (child.isObject3D) {\n      child.parent = parentInstance;\n      child.dispatchEvent({\n        type: 'added'\n      });\n      const restSiblings = parentInstance.children.filter(sibling => sibling !== child); // TODO: the order is out of whack if data objects are present, has to be recalculated\n\n      const index = restSiblings.indexOf(beforeChild);\n      parentInstance.children = [...restSiblings.slice(0, index), child, ...restSiblings.slice(index)];\n      updateInstance(child);\n    } else appendChild(parentInstance, child); // TODO: order!!!\n\n\n    invalidateInstance(child);\n  }\n}\n\nfunction removeRecursive(array, parent, clone = false) {\n  if (array) {\n    // Three uses splice op's internally we may have to shallow-clone the array in order to safely remove items\n    const target = clone ? [...array] : array;\n    target.forEach(child => removeChild(parent, child));\n  }\n}\n\nfunction removeChild(parentInstance, child) {\n  if (child) {\n    if (child.isObject3D) {\n      parentInstance.remove(child);\n    } else {\n      child.parent = null;\n      parentInstance.__objects = parentInstance.__objects.filter(x => x !== child); // Remove attachment\n\n      if (child.attach) parentInstance[child.attach] = null;else if (child.attachArray) parentInstance[child.attachArray] = parentInstance[child.attachArray].filter(x => x !== child);else if (child.attachObject) {\n        delete parentInstance[child.attachObject[0]][child.attachObject[1]];\n      }\n    }\n\n    invalidateInstance(child); // Allow objects to bail out of recursive dispose alltogether by passing dispose={null}\n\n    if (child.dispose !== null) {\n      unstable_runWithPriority(unstable_IdlePriority, () => {\n        // Remove interactivity\n        if (child.__container) child.__container.__interaction = child.__container.__interaction.filter(x => x !== child); // Remove nested child objects\n\n        removeRecursive(child.__objects, child);\n        removeRecursive(child.children, child, true); // Dispose item\n\n        if (child.dispose) child.dispose(); // Remove references\n\n        delete child.__container;\n        delete child.__objects;\n      });\n    }\n  }\n}\n\nfunction switchInstance(instance, type, newProps, fiber) {\n  const parent = instance.parent;\n  const newInstance = createInstance(type, newProps, instance.__container, null, fiber);\n  removeChild(parent, instance);\n  appendChild(parent, newInstance) // This evil hack switches the react-internal fiber node\n  // https://github.com/facebook/react/issues/14983\n  // https://github.com/facebook/react/pull/15021\n  ;\n  [fiber, fiber.alternate].forEach(fiber => {\n    if (fiber !== null) {\n      fiber.stateNode = newInstance;\n\n      if (fiber.ref) {\n        if (is.fun(fiber.ref)) fiber.ref(newInstance);else fiber.ref.current = newInstance;\n      }\n    }\n  });\n}\n\nconst Renderer = Reconciler({\n  now: unstable_now,\n  createInstance,\n  removeChild,\n  appendChild,\n  insertBefore,\n  // @ts-ignore\n  warnsIfNotActing: true,\n  supportsMutation: true,\n  isPrimaryRenderer: false,\n  scheduleTimeout: is.fun(setTimeout) ? setTimeout : undefined,\n  cancelTimeout: is.fun(clearTimeout) ? clearTimeout : undefined,\n  // @ts-ignore\n  setTimeout: is.fun(setTimeout) ? setTimeout : undefined,\n  // @ts-ignore\n  clearTimeout: is.fun(clearTimeout) ? clearTimeout : undefined,\n  noTimeout: -1,\n  appendInitialChild: appendChild,\n  appendChildToContainer: appendChild,\n  removeChildFromContainer: removeChild,\n  insertInContainerBefore: insertBefore,\n\n  commitUpdate(instance, updatePayload, type, oldProps, newProps, fiber) {\n    if (instance.__instance && newProps.object && newProps.object !== instance) {\n      // <instance object={...} /> where the object reference has changed\n      switchInstance(instance, type, newProps, fiber);\n    } else {\n      // This is a data object, let's extract critical information about it\n      const {\n        args: argsNew = []\n      } = newProps,\n            restNew = _objectWithoutPropertiesLoose(newProps, [\"args\"]);\n\n      const {\n        args: argsOld = []\n      } = oldProps,\n            restOld = _objectWithoutPropertiesLoose(oldProps, [\"args\"]); // If it has new props or arguments, then it needs to be re-instanciated\n\n\n      const hasNewArgs = argsNew.some((value, index) => is.obj(value) ? Object.entries(value).some(([key, val]) => val !== argsOld[index][key]) : value !== argsOld[index]);\n\n      if (hasNewArgs) {\n        // Next we create a new instance and append it again\n        switchInstance(instance, type, newProps, fiber);\n      } else {\n        // Otherwise just overwrite props\n        applyProps(instance, restNew, restOld, true);\n      }\n    }\n  },\n\n  hideInstance(instance) {\n    if (instance.isObject3D) {\n      instance.visible = false;\n      invalidateInstance(instance);\n    }\n  },\n\n  unhideInstance(instance, props) {\n    if (instance.isObject3D && props.visible == null || props.visible) {\n      instance.visible = true;\n      invalidateInstance(instance);\n    }\n  },\n\n  hideTextInstance() {\n    throw new Error('Text is not allowed in the react-three-fibre tree. You may have extraneous whitespace between components.');\n  },\n\n  getPublicInstance(instance) {\n    return instance;\n  },\n\n  getRootHostContext() {\n    return emptyObject;\n  },\n\n  getChildHostContext() {\n    return emptyObject;\n  },\n\n  createTextInstance() {},\n\n  finalizeInitialChildren() {\n    return false;\n  },\n\n  prepareUpdate() {\n    return emptyObject;\n  },\n\n  shouldDeprioritizeSubtree() {\n    return false;\n  },\n\n  prepareForCommit() {},\n\n  resetAfterCommit() {},\n\n  shouldSetTextContent() {\n    return false;\n  }\n\n});\nconst LegacyRoot = 0;\nconst ConcurrentRoot = 2;\nconst hasSymbol = is.fun(Symbol) && Symbol.for;\nconst REACT_PORTAL_TYPE = hasSymbol ? Symbol.for('react.portal') : 0xeaca;\nfunction render(element, container, state) {\n  let root = roots.get(container);\n\n  if (!root) {\n    container.__state = state;\n    let newRoot = root = Renderer.createContainer(container, state !== undefined && state.current.concurrent ? ConcurrentRoot : LegacyRoot, false);\n    roots.set(container, newRoot);\n  }\n\n  Renderer.updateContainer(element, root, null, () => undefined);\n  return Renderer.getPublicRootInstance(root);\n}\nfunction unmountComponentAtNode(container) {\n  const root = roots.get(container);\n  if (root) Renderer.updateContainer(null, root, null, () => void roots.delete(container));\n}\nfunction createPortal(children, containerInfo, implementation, key = null) {\n  if (!containerInfo.__objects) containerInfo.__objects = [];\n  return {\n    $$typeof: REACT_PORTAL_TYPE,\n    key: key == null ? null : '' + key,\n    children,\n    containerInfo,\n    implementation\n  };\n}\nRenderer.injectIntoDevTools({\n  bundleType: process.env.NODE_ENV === 'production' ? 0 : 1,\n  version: version,\n  rendererPackageName: 'react-three-fiber',\n  findHostInstanceByFiber: Renderer.findHostInstance\n});\n\nfunction isOrthographicCamera(def) {\n  return def.isOrthographicCamera;\n}\n\nfunction makeId(event) {\n  return (event.eventObject || event.object).uuid + '/' + event.index;\n}\n\nconst stateContext = createContext({});\nconst useCanvas = props => {\n  const {\n    children,\n    gl,\n    camera,\n    orthographic,\n    raycaster,\n    size,\n    pixelRatio,\n    vr = false,\n    concurrent = false,\n    shadowMap = false,\n    sRGB = false,\n    invalidateFrameloop = false,\n    updateDefaultCamera = true,\n    noEvents = false,\n    onCreated,\n    onPointerMissed\n  } = props; // Local, reactive state\n\n  const [ready, setReady] = useState(false);\n  const [mouse] = useState(() => new Vector2());\n  const [defaultRaycaster] = useState(() => {\n    const ray = new Raycaster();\n\n    if (raycaster) {\n      const raycasterProps = _objectWithoutPropertiesLoose(raycaster, [\"filter\"]);\n\n      applyProps(ray, raycasterProps, {});\n    }\n\n    return ray;\n  });\n  const [defaultScene] = useState(() => {\n    const scene = new Scene();\n    scene.__interaction = [];\n    scene.__objects = [];\n    return scene;\n  });\n  const [defaultCam, _setDefaultCamera] = useState(() => {\n    const cam = orthographic ? new OrthographicCamera(0, 0, 0, 0, 0.1, 1000) : new PerspectiveCamera(75, 0, 0.1, 1000);\n    cam.position.z = 5;\n    if (camera) applyProps(cam, camera, {}); // Always look at [0, 0, 0]\n\n    cam.lookAt(0, 0, 0);\n    return cam;\n  });\n  const [clock] = useState(() => new Clock()); // Public state\n\n  const state = useRef({\n    ready: false,\n    active: true,\n    manual: 0,\n    vr,\n    concurrent,\n    noEvents,\n    invalidateFrameloop: false,\n    frames: 0,\n    aspect: 0,\n    subscribers: [],\n    camera: defaultCam,\n    scene: defaultScene,\n    raycaster: defaultRaycaster,\n    mouse,\n    clock,\n    gl,\n    size,\n    viewport: {\n      width: 0,\n      height: 0,\n      factor: 0\n    },\n    initialClick: [0, 0],\n    initialHits: [],\n    pointer: new TinyEmitter(),\n    captured: undefined,\n    events: undefined,\n    subscribe: (ref, priority = 0) => {\n      // If this subscription was given a priority, it takes rendering into its own hands\n      // For that reason we switch off automatic rendering and increase the manual flag\n      // As long as this flag is positive (there could be multiple render subscription)\n      // ..there can be no internal rendering at all\n      if (priority) state.current.manual++;\n      state.current.subscribers.push({\n        ref,\n        priority: priority\n      }); // Sort layers from lowest to highest, meaning, highest priority renders last (on top of the other frames)\n\n      state.current.subscribers = state.current.subscribers.sort((a, b) => a.priority - b.priority);\n      return () => {\n        // Decrease manual flag if this subscription had a priority\n        if (priority) state.current.manual--;\n        state.current.subscribers = state.current.subscribers.filter(s => s.ref !== ref);\n      };\n    },\n    setDefaultCamera: camera => _setDefaultCamera(camera),\n    invalidate: () => invalidate(state),\n    intersect: event => handlePointerMove(event || {})\n  }); // Writes locals into public state for distribution among subscribers, context, etc\n\n  useMemo(() => {\n    state.current.ready = ready;\n    state.current.size = size;\n    state.current.camera = defaultCam;\n    state.current.invalidateFrameloop = invalidateFrameloop;\n    state.current.vr = vr;\n    state.current.gl = gl;\n    state.current.concurrent = concurrent;\n    state.current.noEvents = noEvents;\n  }, [invalidateFrameloop, vr, concurrent, noEvents, ready, size, defaultCam, gl]); // Adjusts default camera\n\n  useMemo(() => {\n    state.current.aspect = size.width / size.height;\n\n    if (isOrthographicCamera(defaultCam)) {\n      state.current.viewport = {\n        width: size.width,\n        height: size.height,\n        factor: 1\n      };\n    } else {\n      const target = new Vector3(0, 0, 0);\n      const distance = defaultCam.position.distanceTo(target);\n      const fov = defaultCam.fov * Math.PI / 180; // convert vertical fov to radians\n\n      const height = 2 * Math.tan(fov / 2) * distance; // visible height\n\n      const width = height * state.current.aspect;\n      state.current.viewport = {\n        width,\n        height,\n        factor: size.width / width\n      };\n    } // #92 (https://github.com/drcmda/react-three-fiber/issues/92)\n    // Sometimes automatic default camera adjustment isn't wanted behaviour\n\n\n    if (updateDefaultCamera) {\n      if (isOrthographicCamera(defaultCam)) {\n        defaultCam.left = size.width / -2;\n        defaultCam.right = size.width / 2;\n        defaultCam.top = size.height / 2;\n        defaultCam.bottom = size.height / -2;\n      } else {\n        defaultCam.aspect = state.current.aspect;\n      }\n\n      defaultCam.updateProjectionMatrix(); // #178: https://github.com/react-spring/react-three-fiber/issues/178\n      // Update matrix world since the renderer is a frame late\n\n      defaultCam.updateMatrixWorld();\n    }\n\n    gl.setSize(size.width, size.height);\n    if (ready) invalidate(state);\n  }, [defaultCam, size, updateDefaultCamera]);\n  /** Events ------------------------------------------------------------------------------------------------ */\n\n  /** Sets up defaultRaycaster */\n\n  const prepareRay = useCallback(({\n    clientX,\n    clientY\n  }) => {\n    if (clientX !== void 0) {\n      const {\n        left,\n        right,\n        top,\n        bottom\n      } = state.current.size;\n      mouse.set((clientX - left) / (right - left) * 2 - 1, -((clientY - top) / (bottom - top)) * 2 + 1);\n      defaultRaycaster.setFromCamera(mouse, state.current.camera);\n    }\n  }, []);\n  /** Intersects interaction objects using the event input */\n\n  const intersect = useCallback((event, prepare = true, filter) => {\n    // Skip event handling when noEvents is set\n    if (state.current.noEvents) return [];\n    if (prepare) prepareRay(event);\n    const seen = new Set();\n    const hits = []; // Allow callers to eliminate event objects\n\n    const eventsObjects = filter ? filter(state.current.scene.__interaction) : state.current.scene.__interaction; // Intersect known handler objects and filter against duplicates\n\n    let intersects = defaultRaycaster.intersectObjects(eventsObjects, true).filter(item => {\n      const id = makeId(item);\n      if (seen.has(id)) return false;\n      seen.add(id);\n      return true;\n    }); // #16031: (https://github.com/mrdoob/three.js/issues/16031)\n    // Allow custom userland intersect sort order\n\n    if (raycaster && raycaster.filter && sharedState.current) intersects = raycaster.filter(intersects, sharedState.current);\n\n    for (let intersect of intersects) {\n      let eventObject = intersect.object; // Bubble event up\n\n      while (eventObject) {\n        const handlers = eventObject.__handlers;\n        if (handlers) hits.push(_extends({}, intersect, {\n          eventObject\n        }));\n        eventObject = eventObject.parent;\n      }\n    }\n\n    return hits;\n  }, []);\n  /**  Calculates click deltas */\n\n  const calculateDistance = useCallback(event => {\n    let dx = event.clientX - state.current.initialClick[0];\n    let dy = event.clientY - state.current.initialClick[1];\n    return Math.round(Math.sqrt(dx * dx + dy * dy));\n  }, []);\n  const hovered = useMemo(() => new Map(), []);\n  /**  Handles intersections by forwarding them to handlers */\n\n  const temp = new Vector3();\n  const handleIntersects = useCallback((event, fn, filter) => {\n    prepareRay(event); // Get fresh intersects\n\n    let hits = intersect(event, false, filter); // If the interaction is captured take that into account, the captured event has to be part of the intersects\n\n    if (state.current.captured && event.type !== 'click' && event.type !== 'wheel') {\n      state.current.captured.forEach(captured => {\n        if (!hits.find(hit => hit.eventObject === captured.eventObject)) hits.push(captured);\n      });\n    } // If anything has been found, forward it to the event listeners\n\n\n    if (hits.length) {\n      const unprojectedPoint = temp.set(mouse.x, mouse.y, 0).unproject(state.current.camera);\n      const delta = event.type === 'click' ? calculateDistance(event) : 0;\n\n      const releasePointerCapture = id => event.target.releasePointerCapture(id);\n\n      const localState = {\n        stopped: false,\n        captured: false\n      };\n\n      for (let hit of hits) {\n        const setPointerCapture = id => {\n          // If the hit is going to be captured flag that we're in captured state\n          if (!localState.captured) {\n            localState.captured = true; // The captured hit array is reset to collect hits\n\n            state.current.captured = [];\n          } // Push hits to the array\n\n\n          if (state.current.captured) state.current.captured.push(hit) // Call the original event now\n          ;\n          event.target.setPointerCapture(id);\n        };\n\n        let raycastEvent = _extends({}, event, {}, hit, {\n          stopped: localState.stopped,\n          delta,\n          unprojectedPoint,\n          ray: defaultRaycaster.ray,\n          camera: state.current.camera,\n          // Hijack stopPropagation, which just sets a flag\n          stopPropagation: () => raycastEvent.stopped = localState.stopped = true,\n          // Pointer-capture needs the hit, on which the user may call stopPropagation()\n          // This makes it harder to use the actual event, because then we loose the connection\n          // to the actual hit, which would mean it's picking up all intersects ...\n          target: _extends({}, event.target, {\n            setPointerCapture,\n            releasePointerCapture\n          }),\n          currentTarget: _extends({}, event.currentTarget, {\n            setPointerCapture,\n            releasePointerCapture\n          }),\n          sourceEvent: event\n        });\n\n        fn(raycastEvent);\n\n        if (localState.stopped === true) {\n          // Propagation is stopped, remove all other hover records\n          // An event handler is only allowed to flush other handlers if it is hovered itself\n          if (hovered.size && Array.from(hovered.values()).find(i => i.object === hit.object)) {\n            handlePointerCancel(raycastEvent, [hit]);\n          }\n\n          break;\n        }\n      }\n    }\n\n    return hits;\n  }, []);\n  const handlePointerMove = useCallback(event => {\n    state.current.pointer.emit('pointerMove', event);\n    const hits = handleIntersects(event, data => {\n      const eventObject = data.eventObject;\n      const handlers = eventObject.__handlers; // Check presence of handlers\n\n      if (!handlers) return; // Call mouse move\n\n      if (handlers.pointerMove) handlers.pointerMove(data); // Check if mouse enter or out is present\n\n      if (handlers.pointerOver || handlers.pointerEnter || handlers.pointerOut || handlers.pointerLeave) {\n        const id = makeId(data);\n        const hoveredItem = hovered.get(id);\n\n        if (!hoveredItem) {\n          // If the object wasn't previously hovered, book it and call its handler\n          hovered.set(id, data);\n          if (handlers.pointerOver) handlers.pointerOver(_extends({}, data, {\n            type: 'pointerover'\n          }));\n          if (handlers.pointerEnter) handlers.pointerEnter(_extends({}, data, {\n            type: 'pointerEnter'\n          }));\n        } else if (hoveredItem.stopped) {\n          // If the object was previously hovered and stopped, we shouldn't allow other items to proceed\n          data.stopPropagation();\n        }\n      }\n    }, // This is onPointerMove, we're only interested in events that exhibit this particular event\n    objects => objects.filter(obj => ['Move', 'Over', 'Enter', 'Out', 'Leave'].some(name => obj.__handlers['pointer' + name]))); // Take care of unhover\n\n    handlePointerCancel(event, hits);\n    return hits;\n  }, []);\n  const handlePointerCancel = useCallback((event, hits) => {\n    state.current.pointer.emit('pointerCancel', event);\n    if (!hits) hits = handleIntersects(event, () => null);\n    Array.from(hovered.values()).forEach(data => {\n      // When no objects were hit or the the hovered object wasn't found underneath the cursor\n      // we call onPointerOut and delete the object from the hovered-elements map\n      if (hits && (!hits.length || !hits.find(i => i.eventObject === data.eventObject))) {\n        const eventObject = data.eventObject;\n        const handlers = eventObject.__handlers;\n\n        if (handlers) {\n          if (handlers.pointerOut) handlers.pointerOut(_extends({}, data, {\n            type: 'pointerout'\n          }));\n          if (handlers.pointerLeave) handlers.pointerLeave(_extends({}, data, {\n            type: 'pointerleave'\n          }));\n        }\n\n        hovered.delete(makeId(data));\n      }\n    });\n  }, []);\n  const handlePointer = useCallback(name => event => {\n    state.current.pointer.emit(name, event); // Collect hits\n\n    const hits = handleIntersects(event, data => {\n      const eventObject = data.eventObject;\n      const handlers = eventObject.__handlers;\n\n      if (handlers && handlers[name]) {\n        // Forward all events back to their respective handlers with the exception of click,\n        // which must must the initial target\n        if (name !== 'click' || state.current.initialHits.includes(eventObject)) handlers[name](data);\n      }\n    }); // If a click yields no results, pass it back to the user as a miss\n\n    if (name === 'pointerDown') {\n      state.current.initialClick = [event.clientX, event.clientY];\n      state.current.initialHits = hits.map(hit => hit.eventObject);\n    }\n\n    if (name === 'click' && !hits.length && onPointerMissed) {\n      if (calculateDistance(event) <= 2) onPointerMissed();\n    }\n  }, [onPointerMissed]);\n  useMemo(() => {\n    state.current.events = {\n      onClick: handlePointer('click'),\n      onWheel: handlePointer('wheel'),\n      onPointerDown: handlePointer('pointerDown'),\n      onPointerUp: handlePointer('pointerUp'),\n      onPointerLeave: e => handlePointerCancel(e, []),\n      onPointerMove: handlePointerMove,\n      // onGotPointerCapture is not needed any longer because the behaviour is hacked into\n      // the event itself (see handleIntersects). But in order for non-web targets to simulate\n      // it we keep the legacy event, which simply flags all current intersects as captured\n      onGotPointerCaptureLegacy: e => state.current.captured = intersect(e, false),\n      onLostPointerCapture: e => (state.current.captured = undefined, handlePointerCancel(e))\n    };\n  }, [onPointerMissed]);\n  /** Events ------------------------------------------------------------------------------------------------- */\n  // Only trigger the context provider when necessary\n\n  const sharedState = useRef();\n  useMemo(() => {\n    const _state$current = state.current,\n          props = _objectWithoutPropertiesLoose(_state$current, [\"ready\", \"manual\", \"vr\", \"noEvents\", \"invalidateFrameloop\", \"frames\", \"subscribers\", \"captured\", \"initialClick\", \"initialHits\"]);\n\n    sharedState.current = props;\n  }, [size, defaultCam]); // Update pixel ratio\n\n  useLayoutEffect(() => void (pixelRatio && gl.setPixelRatio(pixelRatio)), [pixelRatio]); // Update shadow map\n\n  useLayoutEffect(() => {\n    if (shadowMap) {\n      gl.shadowMap.enabled = true;\n      if (typeof shadowMap === 'object') Object.assign(gl, shadowMap);else gl.shadowMap.type = PCFSoftShadowMap;\n    }\n\n    if (sRGB) {\n      gl.toneMapping = ACESFilmicToneMapping;\n      gl.outputEncoding = sRGBEncoding;\n    }\n  }, [shadowMap, sRGB]); // This component is a bridge into the three render context, when it gets rendered\n  // we know we are ready to compile shaders, call subscribers, etc\n\n  const Canvas = useCallback(function Canvas(props) {\n    const activate = () => setReady(true); // eslint-disable-next-line react-hooks/rules-of-hooks\n\n\n    useEffect(() => {\n      const result = onCreated && onCreated(state.current);\n      return void (result && result.then ? result.then(activate) : activate());\n    }, []);\n    return props.children;\n  }, []); // Render v-dom into scene\n\n  useLayoutEffect(() => {\n    render( /*#__PURE__*/createElement(Canvas, null, /*#__PURE__*/createElement(stateContext.Provider, {\n      value: sharedState.current\n    }, typeof children === 'function' ? children(state.current) : children)), defaultScene, state);\n  }, [ready, children, sharedState.current]);\n  useLayoutEffect(() => {\n    if (ready) {\n      // Start render-loop, either via RAF or setAnimationLoop for VR\n      if (!state.current.vr) {\n        invalidate(state);\n      } else if ((gl.xr || gl.vr) && gl.setAnimationLoop) {\n        (gl.xr || gl.vr).enabled = true;\n        gl.setAnimationLoop(t => renderGl(state, t, 0, true));\n      } else console.warn('the gl instance does not support VR!');\n    }\n  }, [ready, invalidateFrameloop]); // Dispose renderer on unmount\n\n  useEffect(() => () => {\n    if (state.current.gl) {\n      if (state.current.gl.forceContextLoss) state.current.gl.forceContextLoss();\n      if (state.current.gl.dispose) state.current.gl.dispose();\n      state.current.gl = undefined;\n      unmountComponentAtNode(state.current.scene);\n      state.current.active = false;\n    }\n  }, []);\n  return state.current.events;\n};\n\nfunction useContext(context) {\n  let result = useContext$1(context);\n\n  if (!result) {\n    console.warn('hooks can only be used within the canvas! https://github.com/react-spring/react-three-fiber#hooks');\n  }\n\n  return result;\n}\n\nfunction useFrame(callback, renderPriority = 0) {\n  const {\n    subscribe\n  } = useContext(stateContext); // Update ref\n\n  const ref = useRef(callback);\n  useLayoutEffect(() => void (ref.current = callback), [callback]); // Subscribe/unsub\n\n  useEffect(() => {\n    const unsubscribe = subscribe(ref, renderPriority);\n    return () => unsubscribe();\n  }, [renderPriority]);\n  return null;\n}\nfunction useThree() {\n  return useContext(stateContext);\n}\nfunction useUpdate(callback, dependents, optionalRef) {\n  const {\n    invalidate\n  } = useContext(stateContext);\n  const localRef = useRef();\n  const ref = optionalRef ? optionalRef : localRef;\n  useLayoutEffect(() => {\n    if (ref.current) {\n      callback(ref.current);\n      invalidate();\n    }\n  }, dependents);\n  return ref;\n}\nfunction useResource(optionalRef) {\n  const [_, forceUpdate] = useState(false);\n  const localRef = useRef(undefined);\n  const ref = optionalRef ? optionalRef : localRef;\n  useLayoutEffect(() => void forceUpdate(i => !i), [ref.current]);\n  return [ref, ref.current];\n}\nconst blackList = ['id', 'uuid', 'type', 'children', 'parent', 'matrix', 'matrixWorld', 'matrixWorldNeedsUpdate', 'modelViewMatrix', 'normalMatrix'];\n\nfunction prune(props) {\n  const reducedProps = _extends({}, props); // Remove black listed props\n\n\n  blackList.forEach(name => delete reducedProps[name]); // Remove functions\n\n  Object.keys(reducedProps).forEach(name => typeof reducedProps[name] === 'function' && delete reducedProps[name]); // Prune materials and geometries\n\n  if (reducedProps.material) reducedProps.material = prune(reducedProps.material);\n  if (reducedProps.geometry) reducedProps.geometry = prune(reducedProps.geometry); // Return cleansed object\n\n  return reducedProps;\n}\n\nfunction useLoader(Proto, url, extensions) {\n  const loader = useMemo(() => {\n    // Construct new loader\n    const temp = new Proto(); // Run loader extensions\n\n    if (extensions) extensions(temp);\n    return temp;\n  }, [Proto]); // Use suspense to load async assets\n\n  const results = usePromise((Proto, url) => {\n    const urlArray = Array.isArray(url) ? url : [url];\n    return Promise.all(urlArray.map(url => new Promise(res => loader.load(url, data => {\n      if (data.scene) {\n        // This has to be deprecated at some point!\n        data.__$ = []; // Nodes and materials are better\n\n        data.nodes = {};\n        data.materials = {};\n        data.scene.traverse(obj => {\n          data.__$.push(prune(obj));\n\n          if (obj.name) data.nodes = _extends({}, data.nodes, {\n            [obj.name]: obj\n          });\n          if (obj.material && !data.materials[obj.material.name]) data.materials[obj.material.name] = obj.material;\n        });\n      }\n\n      res(data);\n    }))));\n  }, [Proto, url]); // Return the object/s\n\n  return Array.isArray(url) ? results : results[0];\n}\nfunction useCamera(camera, props) {\n  const {\n    mouse\n  } = useThree();\n  const [raycast] = useState(() => {\n    let raycaster = new Raycaster();\n    if (props) applyProps(raycaster, props, {});\n    return function (_, intersects) {\n      raycaster.setFromCamera(mouse, camera);\n      const rc = this.constructor.prototype.raycast.bind(this);\n      if (rc) rc(raycaster, intersects);\n    };\n  });\n  return raycast;\n}\n\nconst vector = new Vector3();\n\nfunction calculatePosition(el, camera, size) {\n  vector.setFromMatrixPosition(el.matrixWorld);\n  vector.project(camera);\n  const widthHalf = size.width / 2;\n  const heightHalf = size.height / 2;\n  return [vector.x * widthHalf + widthHalf, -(vector.y * heightHalf) + heightHalf];\n}\n\nconst Dom = React__default.forwardRef((_ref, ref) => {\n  let {\n    children,\n    eps = 0.001,\n    style,\n    className,\n    prepend,\n    center\n  } = _ref,\n      props = _objectWithoutPropertiesLoose(_ref, [\"children\", \"eps\", \"style\", \"className\", \"prepend\", \"center\"]);\n\n  const {\n    gl,\n    scene,\n    camera,\n    size\n  } = useThree();\n  const [el] = useState(() => document.createElement('div'));\n  const group = useRef(null);\n  const old = useRef([0, 0]);\n  useEffect(() => {\n    if (group.current) {\n      scene.updateMatrixWorld();\n      const vec = calculatePosition(group.current, camera, size);\n      el.style.cssText = \"position:absolute;top:0;left:0;transform:translate3d(\" + vec[0] + \"px,\" + vec[1] + \"px,0);\";\n\n      if (gl.domElement.parentNode) {\n        if (prepend) gl.domElement.parentNode.prepend(el);else gl.domElement.parentNode.appendChild(el);\n      }\n\n      return () => {\n        if (gl.domElement.parentNode) gl.domElement.parentNode.removeChild(el);\n        ReactDOM.unmountComponentAtNode(el);\n      };\n    } // eslint-disable-next-line react-hooks/exhaustive-deps\n\n  }, []);\n  useEffect(() => void ReactDOM.render( /*#__PURE__*/React__default.createElement(\"div\", {\n    style: _extends({\n      transform: center ? 'translate3d(-50%,-50%,0)' : 'none'\n    }, style),\n    className: className,\n    ref: ref\n  }, children), el));\n  useFrame(() => {\n    if (group.current) {\n      const vec = calculatePosition(group.current, camera, size);\n\n      if (Math.abs(old.current[0] - vec[0]) > eps || Math.abs(old.current[1] - vec[1]) > eps) {\n        el.style.transform = \"translate3d(\" + vec[0] + \"px,\" + vec[1] + \"px,0)\";\n      }\n\n      old.current = vec;\n    }\n  });\n  return /*#__PURE__*/React__default.createElement(\"group\", _extends({}, props, {\n    ref: group\n  }));\n});\n\nconst defaultStyles = {\n  position: 'relative',\n  width: '100%',\n  height: '100%',\n  overflow: 'hidden'\n};\n\nfunction Content(_ref) {\n  let {\n    children,\n    setEvents,\n    container,\n    renderer,\n    effects\n  } = _ref,\n      props = _objectWithoutPropertiesLoose(_ref, [\"children\", \"setEvents\", \"container\", \"renderer\", \"effects\"]);\n\n  // Create renderer\n  const [gl] = useState(renderer);\n  if (!gl) console.warn('No renderer created!'); // Mount and unmount managemenbt\n\n  useEffect(() => effects && effects(gl, container), []); // Init canvas, fetch events, hand them back to the wrapping div\n\n  const events = useCanvas(_extends({}, props, {\n    children,\n    gl: gl\n  }));\n  useEffect(() => void setEvents(events), [events]);\n  return null;\n}\n\nconst ResizeContainer = React__default.memo(function ResizeContainer(props) {\n  const {\n    preRender,\n    resize,\n    style\n  } = props,\n        restSpread = _objectWithoutPropertiesLoose(props, [\"renderer\", \"effects\", \"children\", \"vr\", \"gl2\", \"concurrent\", \"shadowMap\", \"sRGB\", \"orthographic\", \"invalidateFrameloop\", \"updateDefaultCamera\", \"noEvents\", \"gl\", \"camera\", \"raycaster\", \"pixelRatio\", \"onCreated\", \"onPointerMissed\", \"preRender\", \"resize\", \"style\"]);\n\n  const containerRef = useRef(); // onGotPointerCaptureLegacy is a fake event used by non-web targets to simulate poinzter capture\n\n  const [_ref2, setEvents] = useState({});\n\n  const events = _objectWithoutPropertiesLoose(_ref2, [\"onGotPointerCaptureLegacy\"]);\n\n  const [bind, size] = useMeasure(resize || {\n    scroll: true,\n    debounce: {\n      scroll: 50,\n      resize: 0\n    },\n    polyfill: typeof window === 'undefined' || !window.ResizeObserver ? ResizeObserver : undefined\n  }); // Flag view ready once it's been measured out\n\n  const readyFlag = useRef(false);\n  const ready = useMemo(() => readyFlag.current = readyFlag.current || !!size.width && !!size.height, [size]);\n  const state = useMemo(() => ({\n    size,\n    setEvents,\n    container: containerRef.current\n  }), [size]); // Allow Gatsby, Next and other server side apps to run. Will output styles to reduce flickering.\n\n  if (typeof window === 'undefined') return /*#__PURE__*/React__default.createElement(\"div\", _extends({\n    style: _extends({}, defaultStyles, {}, style)\n  }, restSpread), preRender); // Render the canvas into the dom\n\n  return /*#__PURE__*/React__default.createElement(\"div\", _extends({\n    ref: mergeRefs([bind, containerRef]),\n    style: _extends({}, defaultStyles, {}, style)\n  }, events, restSpread), preRender, ready && /*#__PURE__*/React__default.createElement(Content, _extends({}, props, state)));\n});\n\nconst Canvas = React__default.memo(function Canvas(_ref) {\n  let {\n    children\n  } = _ref,\n      props = _objectWithoutPropertiesLoose(_ref, [\"children\"]);\n\n  const canvasRef = useRef();\n  return /*#__PURE__*/React__default.createElement(ResizeContainer, _extends({}, props, {\n    renderer: () => {\n      if (canvasRef.current) {\n        const params = _extends({\n          antialias: true,\n          alpha: true\n        }, props.gl);\n\n        const temp = new WebGLRenderer(_extends({\n          canvas: canvasRef.current,\n          context: props.gl2 ? canvasRef.current.getContext('webgl2', params) : undefined\n        }, params));\n        return temp;\n      }\n    },\n    preRender: /*#__PURE__*/React__default.createElement(\"canvas\", {\n      ref: canvasRef,\n      style: {\n        display: 'block'\n      }\n    })\n  }), children);\n});\n\nexport { Canvas, Dom, Renderer, addEffect, addTail, applyProps, createPortal, extend, invalidate, isOrthographicCamera, render, renderGl, stateContext, unmountComponentAtNode, useCamera, useCanvas, useFrame, useLoader, useResource, useThree, useUpdate };\n"]},"metadata":{},"sourceType":"module"}